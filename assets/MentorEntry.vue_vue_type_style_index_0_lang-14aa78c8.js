import{d as J,u as Q,a as W,K as X,R as A,r as c,w as Z,o as l,c as m,e as s,h as r,l as e,B as p,f as o,m as ee,x as _,v as i,j as n,F as S,M as g,Y as te,g as se,E as ae,i as q,k as N,A as T,C as le,D as oe,U as ne,a9 as ie,t as re,q as D,p as de}from"./index-2a8a9a72.js";import{u as ue}from"./entry-d59bbcb8.js";import{u as ce,_ as pe}from"./Slave.vue_vue_type_script_setup_true_lang-ac41a195.js";import{E as _e}from"./EntryContainer-54ee7a58.js";const fe={class:"d-flex align-start w-100 justify-start flex-column"},me={class:"d-flex ml-4 mt-auto mb-auto flex-column justify-start"},ge={style:{"line-height":"1.2"},class:"font-author font-weight-semibold"},ye={key:0,class:"text-gray lh-1 text-body-2"},he={style:{"column-gap":"16px"},class:"mr-7"},ve={class:"text-h6 font-weight-black",style:{"line-height":"1.3"}},we={class:"text-body font-weight-regular"},xe={style:{"white-space":"nowrap"}},be={class:"text-body font-weight-regular",style:{"white-space":"nowrap"}},ke=["innerHTML"],Ve={class:"d-flex mt-5 flex-column justify-start"},Ce={key:0,class:"mb-2"},je=r("span",{class:"mdi mdi-map-marker text-teal-lighten-1"},null,-1),ze={key:0},Be={style:{"row-gap":"6px"},class:"d-flex flex-row flex-wrap justify-start align-center"},$e={class:"d-flex flex-row flex-lg-column ma-auto ma-sm-0 pa-0 align-center align-lg-end",style:{"column-gap":"8px","row-gap":"4px"}},Ae={key:3,class:"text-body font-weight-regular"},Ee={key:1,style:{"row-gap":"6px"},class:"d-flex mt-2 flex-row flex-wrap justify-start align-center"},Me={key:2,class:"mt-2 w-100 text-red"},Ne=J({__name:"MentorEntry",props:{entry:{type:Object,required:!0},show_location:{type:Boolean,required:!1,default:!1},hide_user:{type:Boolean,required:!1,default:!1}},async setup(O){let x,E;const b=O;let M=Q(),U=W(),F=ce(),h=ue(),a=U.user,t=X(b.entry),y=a&&t.author._id===a._id,L=a&&(A.isGlobalAdmin(a.roles)||A.isAdminOfSchool(a.roles,t.school._id)||A.isAdminOfTown(a.roles,t.town._id)),v=c(a&&t.responses.includes(a._id)),k=c(v.value?"Убрать отклик":"Откликнуться"),V=c(!1),C=c(!1);async function H(){if(!a)return M.push("/login");V.value=!0,t.responses.includes(a._id)?(await h.cancel_response(t._id),t.responses=t.responses.filter(w=>w!==(a==null?void 0:a._id)),k.value="Откликнуться",v.value=!1):(await h.response(t._id),t.responses.push(a._id),k.value="Убрать отклик",v.value=!0),V.value=!1}let f=c(!1),I=([x,E]=Z(async()=>Promise.all(t.responses.map(async w=>await F.get_by_id(w)))),x=await x,E(),x);async function P(){C.value=!0,await h.delete_entry(t._id),C.value=!1}let j=c(!1),z=c(!1),B=c(!1),$=c(!1);async function G(){j.value=!0,await h.verify(t._id,!0),z.value=!0,$.value=!1,j.value=!1}async function K(){B.value=!0,await h.verify(t._id,!1),$.value=!0,z.value=!1,B.value=!1}return(w,d)=>(l(),m(_e,{class:"justify-space-between",style:{position:"relative"}},{default:s(()=>{var R;return[r("div",fe,[e(b).hide_user?i("",!0):(l(),p("div",{key:0,onClick:d[0]||(d[0]=u=>e(M).push(`/user/${e(t).author._id}`)),class:"d-flex flex-row mr-7 mb-2 flex-nowrap align-start-center justify-start cursor-pointer"},[o(ee,{image:e(t).author.avatar_url,color:"blue",class:"pt-1"},null,8,["image"]),r("div",me,[r("div",ge,_(e(t).author.name),1),e(t).author.ranks.length>0?(l(),p("div",ye,_((R=e(t).author.ranks)==null?void 0:R.join(", ")),1)):i("",!0)])])),r("div",he,[r("span",ve,_(e(t).subject),1),e(t).limit?(l(),p(S,{key:0},[n("    "),r("span",we,[n(" лимит "),r("span",xe,_(e(t).limit)+" чел. ",1)]),n("    "),r("span",be," осталось "+_(e(t).limit-e(t).responses.length),1)],64)):i("",!0)]),r("div",{innerHTML:e(t).description,class:"mt-2"},null,8,ke)]),r("div",Ve,[e(b).show_location||!e(a)||e(t).school._id!==e(a).school._id?(l(),p("div",Ce,[je,!e(a)||e(t).town._id!==e(a).town._id?(l(),p("span",ze,_(e(t).town.name+", "),1)):i("",!0),n(" "+_(e(t).school.name),1)])):i("",!0),r("div",Be,[!e(y)&&!e(t).on_moderation?(l(),m(g,{key:0,onClick:d[1]||(d[1]=u=>H()),loading:e(V),disabled:!e(v)&&e(t).limit?e(t).limit-e(t).responses.length<=0:!1,size:"small",variant:"tonal",class:te(`text-body-2 pl-5 pr-5 mr-3 font-weight-semibold ${e(v)?"bg-accent":"bg-button"}`)},{default:s(()=>[n(_(e(k)),1)]),_:1},8,["loading","disabled","class"])):i("",!0),e(b).hide_user?i("",!0):(l(),m(g,{key:1,size:"small",to:`/user/${e(t).author._id}`,variant:"tonal",class:"text-body-2 pl-5 pr-5 font-weight-semibold bg-button"},{default:s(()=>[n(" Посмотреть профиль ")]),_:1},8,["to"])),e(y)&&e(t).responses.length>0?(l(),m(g,{key:2,size:"small",variant:"tonal",class:"text-body-2 pl-5 pr-5 mr-3 font-weight-semibold bg-button",onClick:d[4]||(d[4]=u=>w.responses=e(t).responses)},{default:s(()=>[n(" Посмотреть отклики ("+_(e(t).responses.length)+") ",1),o(ne,{modelValue:e(f),"onUpdate:modelValue":d[3]||(d[3]=u=>N(f)?f.value=u:f=u),activator:"parent",scrollable:"",class:"align-center"},{default:s(()=>[o(se,null,{default:s(()=>[o(ae,{style:{"min-height":"83vh"},class:"rounded-lg w-100 ma-auto"},{default:s(()=>[o(q,{onClick:d[2]||(d[2]=u=>N(f)?f.value=!1:f=!1),style:{position:"absolute",top:"7px",right:"7px"}},{default:s(()=>[n(" mdi-close ")]),_:1}),o(T,{class:"flex-row flex-wrap pa-8"},{default:s(()=>[(l(!0),p(S,null,le(e(I),(u,Y)=>(l(),m(oe,{key:Y,cols:"12",lg:"6"},{default:s(()=>[o(T,{class:"align-center h-100 ma-0 response d-flex flex-column flex-sm-row",style:{gap:"10px"}},{default:s(()=>[o(pe,{user:u},null,8,["user"]),r("div",$e,[o(g,{size:"small",variant:"tonal",class:"text-body-2 pl-5 pr-5 font-weight-semibold bg-button"},{default:s(()=>[n(" Заблокировать ")]),_:1}),o(g,{size:"small",variant:"tonal",class:"text-body-2 pl-5 pr-5 font-weight-semibold bg-button"},{default:s(()=>[n(" Убрать отклик ")]),_:1})])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})):i("",!0),e(t).responses.length===0&&e(y)&&!e(t).on_moderation&&e(t).moderation_result?(l(),p("div",Ae," Откликов нет ")):i("",!0)]),e(L)&&e(t).on_moderation?(l(),p("div",Ee,[o(g,{size:"small",variant:"tonal",class:"text-body-2 mr-3 pl-5 pr-5 font-weight-semibold bg-light-green-darken-2",onClick:G,loading:e(j),disabled:e(z)},{default:s(()=>[n(" Принять ")]),_:1},8,["loading","disabled"]),o(g,{size:"small",variant:"tonal",class:"text-body-2 pl-5 pr-5 font-weight-semibold bg-red",onClick:K,loading:e(B),disabled:e($)},{default:s(()=>[n(" Отказать ")]),_:1},8,["loading","disabled"])])):i("",!0),e(y)&&!e(t).on_moderation&&!e(t).moderation_result?(l(),p("div",Me," Ваша запись не одобрена администратором. Отредактируйте запись, чтобы отправить отправить на проверку снова ")):i("",!0)]),e(y)||e(L)?(l(),m(ie,{key:0,location:"start"},{activator:s(({props:u})=>[o(q,re({class:"pa-4",style:{position:"absolute",right:"12px",top:"12px"},icon:"mdi-dots-vertical"},u),null,16)]),default:s(()=>[o(de,{density:"compact"},{default:s(()=>[e(y)?(l(),m(D,{key:0,to:`/edit/${e(t)._id}`,"prepend-icon":"mdi-pencil"},{default:s(()=>[n(" Редактировать ")]),_:1},8,["to"])):i("",!0),o(D,{onClick:P,loading:e(C),"prepend-icon":"mdi-delete"},{default:s(()=>[n(" Удалить ")]),_:1},8,["loading"])]),_:1})]),_:1})):i("",!0)]}),_:1}))}});export{Ne as _};
