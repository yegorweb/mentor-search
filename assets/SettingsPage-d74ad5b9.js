import{d as W,a as X,u as Y,r as c,E as N,L as Z,c as C,w as t,f as q,o as w,e,C as i,M as H,N as ee,h as a,O as P,A as p,i as v,P as T,Q as le,R as te,B as m,T as R,W as ae,X as A,Y as se,Z as oe,n as ne,p as ue,I as B,g as ie,j as F,F as de,s as E,t as re,G as I,J as me,K as ce,_ as ve}from"./index-e2874abf.js";import{_ as fe}from"./BackButton.vue_vue_type_script_setup_true_lang-7f34b820.js";import{u as pe,a as $}from"./vee-validate.esm-a478b67f.js";import{T as be}from"./TownService-98a1bdbc.js";import{S as ge}from"./SchoolService-84194114.js";const _e=h=>(me("data-v-07842dbb"),h=h(),ce(),h),Ve={class:"d-flex flex-column"},we=_e(()=>p("div",{class:"text-body-1 mb-2 font-weight-bold"},"Контакты",-1)),he={class:"text-body-2 text-red"},ye=W({__name:"SettingsPage",async setup(h){let d,y;document.title="Натройки — Ищу наставника";let j=X();Y();let u=j.getUser(),n=c(1),U=c(!1),G=([d,y]=N(()=>be.getTowns()),d=await d,y(),d).data,D=([d,y]=N(()=>ge.get_all()),d=await d,y(),d).data;function L(){return D.filter(o=>o.town._id===f.value._id)}function O(){let o=[{digit:"—",number:0}];for(let l=1;l<=11;l++)o.push({digit:l.toString(),number:l});return o}const{meta:z,handleSubmit:J,handleReset:xe}=pe({initialValues:{contacts:[]},validationSchema:{name(o){return!o||o.length<4?"слишком короткое имя":o.length>21?"слишком длинное имя":!0},description(o){return o&&o.length>150?"слишком длинное описание":!0},contacts(o){for(let l of o)if(!l.name||l.name.length===0||!l.link||l.link.length===0)return"в каждом контакте должны быть название и ссылка";return!0}}}),K=J(async o=>{U.value=!0,await j.updateUser(Object.assign(o,{town:f.value,school:g.value,grade:_.value,roles:V.value})).then(()=>window.location.href=`/user/${u._id}`).finally(()=>U.value=!1)});let b=c(u.roles.includes("mentor"));Z(b,o=>{o?V.value.push("mentor"):V.value=V.value.filter(l=>l!=="mentor"),console.log(V.value)});let x=$("name"),k=$("description"),r=$("contacts");x.value.value=u.name,k.value.value=u.description,r.value.value=u.contacts;let f=c(u.town),g=c(u.school),_=c(u.grade),V=c(u.roles);return(o,l)=>(w(),C(q,null,{default:t(()=>[e(fe),e(m,{class:"mt-1 align-start"},{default:t(()=>[e(i,{cols:"12",md:"5",lg:"4",xl:"3"},{default:t(()=>[H(e(P,null,{default:t(()=>[p("div",Ve,[p("div",{onClick:l[0]||(l[0]=s=>v(n)?n.value=1:n=1),class:T(`cursor-pointer pt-1 pb-1 font-weight-semibold ${a(n)!==1?"text-teal-darken-1":""}`)},"Редактрировать профиль",2),p("div",{onClick:l[1]||(l[1]=s=>v(n)?n.value=2:n=2),class:T(`cursor-pointer pt-1 pb-1 font-weight-semibold ${a(n)!==2?"text-teal-darken-1":""}`)},"Изменить пароль",2),p("div",{onClick:l[2]||(l[2]=s=>v(n)?n.value=3:n=3),class:T(`cursor-pointer pt-1 pb-1 font-weight-semibold ${a(n)!==3?"text-teal-darken-1":""}`)},"Мои подписки",2)])]),_:1},512),[[ee,a(n)===1]])]),_:1}),e(i,null,{default:t(()=>[a(n)===1?(w(),C(P,{key:0},{default:t(()=>[e(le,{onSubmit:te(a(K),["prevent"])},{default:t(()=>[e(m,{class:"mt-1"},{default:t(()=>[e(i,{cols:"12",sm:"6"},{default:t(()=>[e(R,{label:"Имя Фамилия",modelValue:a(x).value.value,"onUpdate:modelValue":l[3]||(l[3]=s=>a(x).value.value=s),"error-messages":a(x).errorMessage.value,placeholder:"Василий Петров",variant:"outlined",density:"comfortable"},null,8,["modelValue","error-messages"])]),_:1}),e(i,{cols:"12",sm:"6"},{default:t(()=>[e(ae,{label:"Кто вы?",modelValue:a(b),"onUpdate:modelValue":l[4]||(l[4]=s=>v(b)?b.value=s:b=s),"hide-details":"",column:""},{default:t(()=>[e(A,{label:"Наставляемый",value:!1}),e(A,{label:"Наставник",value:!0})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(m,null,{default:t(()=>[e(i,{cols:"12",sm:"6"},{default:t(()=>[e(se,{label:"Описание",modelValue:a(k).value.value,"onUpdate:modelValue":l[5]||(l[5]=s=>a(k).value.value=s),"error-messages":a(k).errorMessage.value,counter:150,variant:"outlined",class:"w-100"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(m,null,{default:t(()=>[e(i,{cols:"12"},{default:t(()=>[e(m,{class:"flex-column align-start ma-0 pa-0"},{default:t(()=>[we,a(r).value.value.length>0?(w(),C(m,{key:0,class:"flex-column mb-2 ma-0 pa-0 w-100",style:{gap:"6px"}},{default:t(()=>[e(oe,{name:"list"},{default:t(()=>[(w(!0),ne(de,null,ue(a(r).value.value,(s,M)=>(w(),C(m,{class:"flex-row justify-space-between align-stretch ma-0 pa-0",key:M},{default:t(()=>[e(R,{placeholder:"ВКонтакте",modelValue:s.name,"onUpdate:modelValue":S=>s.name=S,variant:"outlined",density:"compact",class:"w-30","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),e(R,{placeholder:"vk.com/vasiliy",modelValue:s.link,"onUpdate:modelValue":S=>s.link=S,variant:"outlined",density:"compact",class:"ml-2","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),e(B,{variant:"tonal",onClick:S=>a(r).value.value=a(r).value.value.filter((ke,Q)=>Q!==M),class:"ml-2 font-weight-semibold bg-button"},{default:t(()=>[e(ie,null,{default:t(()=>[F("mdi-delete")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]),_:1})):E("",!0),p("div",he,re(a(r).errorMessage.value),1),e(B,{"prepend-icon":"mdi-plus",variant:"tonal",disabled:a(r).value.value.length>3,onClick:l[6]||(l[6]=s=>a(r).value.value.push({name:"",link:"http://"})),class:"text-body-2 pl-5 pr-5 font-weight-semibold bg-button"},{default:t(()=>[F("Добавить")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),e(m,{class:"mt-8"},{default:t(()=>[e(i,{cols:"12",sm:"6"},{default:t(()=>[e(I,{label:"Город",modelValue:a(f),"onUpdate:modelValue":l[7]||(l[7]=s=>v(f)?f.value=s:f=s),items:a(G),"item-title":"name","return-object":"",density:"comfortable",variant:"outlined",class:"w-100","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(i,{cols:"12",sm:"6"},{default:t(()=>[e(I,{label:"Школа",modelValue:a(g),"onUpdate:modelValue":l[8]||(l[8]=s=>v(g)?g.value=s:g=s),items:L(),"item-title":"name","return-object":"",density:"comfortable",variant:"outlined",class:"w-100","hide-details":""},null,8,["modelValue","items"])]),_:1}),e(i,{cols:"12",sm:"6"},{default:t(()=>[e(I,{label:"Класс",modelValue:a(_),"onUpdate:modelValue":l[9]||(l[9]=s=>v(_)?_.value=s:_=s),items:O(),"item-title":"digit","item-value":"number",density:"comfortable",variant:"outlined",class:"w-100","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1}),e(B,{type:"submit",loading:a(U),disabled:!a(z).valid,class:"bg-accent mb-2 mt-8"},{default:t(()=>[F(" Сохранить ")]),_:1},8,["loading","disabled"])]),_:1},8,["onSubmit"])]),_:1})):E("",!0)]),_:1})]),_:1})]),_:1}))}});const Be=ve(ye,[["__scopeId","data-v-07842dbb"]]);export{Be as default};
