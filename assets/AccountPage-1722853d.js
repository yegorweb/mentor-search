import{_ as _sfc_main$1}from"./BackButton.vue_vue_type_script_setup_true_lang-b11ea951.js";import{_ as _sfc_main$2}from"./MentorEntry.vue_vue_type_style_index_0_lang-54ec128a.js";import{d as defineComponent,u as useRouter,a as useAuth,I as useUser,r as ref,w as withAsyncContext,R as RolesService,J as onBeforeRouteUpdate,K as watch,c as createBlock,b as withCtx,g as VContainer,o as openBlock,B as createBaseVNode,f as createVNode,j as unref,p as createElementBlock,h as VIcon,v as createCommentVNode,l as VAvatar,t as toDisplayString,k as createTextVNode,F as Fragment,q as renderList,L as VBtn,M as VTooltip,N as VCombobox,O as VChip,y as mergeProps,D as VCol,C as VRow,P as pushScopeId,Q as popScopeId}from"./index-a7c02cab.js";import{u as useEntry}from"./entry-0acbcb40.js";import{_ as _export_sfc}from"./_plugin-vue_export-helper-c27b6911.js";import"./EntryContainer-86434311.js";import"./EntryService-ef81a948.js";const _withScopeId=r=>(pushScopeId("data-v-e5d66302"),r=r(),popScopeId(),r),_hoisted_1={class:"d-flex flex-row w-100 flex-nowrap justify-space-between align-center"},_hoisted_2=_withScopeId(()=>createBaseVNode("div",{class:"text-body-4 ml-1 font-weight-semibold"},"выйти",-1)),_hoisted_3={style:{"column-gap":"30px","row-gap":"10px"},class:"box w-100 mt-4 d-flex flex-column flex-sm-row flex-nowrap justify-center justify-sm-start align-center align-sm-start"},_hoisted_4={class:"d-flex flex-column justify-center justify-sm-start w-sm-100 align-center align-sm-start"},_hoisted_5={class:"text-h5 text-center font-weight-bold"},_hoisted_6={style:{"column-gap":"20px"},class:"d-flex mt-1 align-center justify-center justify-sm-start flex-wrap flex-row font-weight-bold text-text_gray"},_hoisted_7={key:0,class:"text-center"},_hoisted_8={key:1},_hoisted_9={class:"font-weight-bold text-text_gray"},_hoisted_10={key:0,class:"mt-2 pb-2 text-center text-sm-start"},_hoisted_11={key:1,class:"d-flex pt-2 flex-row flex-wrap"},_hoisted_12=["href"],_hoisted_13=_withScopeId(()=>createBaseVNode("div",{class:"text-h5 font-weight-bold mt-8"},"Управление",-1)),_hoisted_14=_withScopeId(()=>createBaseVNode("div",{class:"text-h5 font-weight-bold"},"На модерации",-1)),_hoisted_15={class:"mt-6 entries-container"},_hoisted_16=_withScopeId(()=>createBaseVNode("div",{class:"text-h5 mb-4 mt-8 font-weight-bold"},"Мои отклики",-1)),_hoisted_17={key:0,class:"pt-2 pb-4 entries-container"},_hoisted_18={key:0,class:"text-h5 mb-4 font-weight-bold"},_hoisted_19={class:"entries-container"},_hoisted_20={key:0,class:"text-h5 mb-4 font-weight-bold"},_hoisted_21={class:"entries-container"},_hoisted_22=_withScopeId(()=>createBaseVNode("div",{class:"text-h5 font-weight-bold"},"Наставник по",-1)),_hoisted_23={class:"entries-container mt-6"},_hoisted_24=_withScopeId(()=>createBaseVNode("div",{class:"text-h5 font-weight-bold"},"Уроки",-1)),_hoisted_25={class:"mt-4 entries-container"},_hoisted_26=_withScopeId(()=>createBaseVNode("div",{class:"text-h5 font-weight-bold"},"Клубы",-1)),_hoisted_27={class:"mt-4 entries-container"},_sfc_main=defineComponent({__name:"AccountPage",props:["id"],async setup(__props){var r,l,a,i,c,_,d;let __temp,__restore;const props=__props;let new_user=eval(localStorage.getItem("newUser")||"false"),id=props.id;useRouter();let auth=useAuth(),viewer=auth.getUser(),userStore=useUser(),user=ref((viewer==null?void 0:viewer._id)===id?viewer:([__temp,__restore]=withAsyncContext(()=>userStore.get_by_id(id)),__temp=await __temp,__restore(),__temp)),my_page=ref((viewer==null?void 0:viewer._id)===id),viewer_is_admin=viewer&&(RolesService.isAdminOfSchool(viewer.roles,user.value.school._id)||RolesService.isAdminOfTown(viewer.roles,user.value.town._id)||RolesService.isGlobalAdmin(viewer.roles)),viewer_is_some_admin=viewer&&RolesService.isSomeAdmin(viewer.roles),entryStore=useEntry(),town=ref(user.value.town),school=ref(user.value.school),entries=ref(([__temp,__restore]=withAsyncContext(()=>entryStore.get_by_author(user.value._id)),__temp=await __temp,__restore(),__temp)),mentorship_entries=ref((r=entries.value)==null?void 0:r.filter(t=>t.type==="mentor"&&t.on_moderation===!1&&t.moderation_result===!0)),lesson_entries=ref((l=entries.value)==null?void 0:l.filter(t=>t.type==="lesson"&&t.on_moderation===!1&&t.moderation_result===!0)),club_entries=ref((a=entries.value)==null?void 0:a.filter(t=>t.type==="club"&&t.on_moderation===!1&&t.moderation_result===!0)),entries_on_moderation=ref((i=entries.value)==null?void 0:i.filter(t=>t.on_moderation===!0||my_page.value&&t.on_moderation===!1&&t.moderation_result===!1));function getType(){return RolesService.isSomeAdmin(user.value.roles)?"админ":user.value.roles.includes("mentor")?"наставник":"наставляемый"}document.title=`${user.value.name} — Ищу наставника`,onBeforeRouteUpdate(t=>{window.location.href=t.path});let responsed_entries=ref([]),responsed_mentorship_entries=ref([]),responsed_lesson_entries=ref([]),responsed_club_entries=ref([]);RolesService.isMentor(user.value.roles)&&(responsed_entries.value=([__temp,__restore]=withAsyncContext(()=>userStore.get_my_responses()),__temp=await __temp,__restore(),__temp),responsed_mentorship_entries.value=(c=responsed_entries.value)==null?void 0:c.filter(t=>t.type==="mentor"),responsed_lesson_entries.value=(_=responsed_entries.value)==null?void 0:_.filter(t=>t.type==="lesson"),responsed_club_entries.value=(d=responsed_entries.value)==null?void 0:d.filter(t=>t.type==="club"));function removeRank(t){user.value.ranks.splice(user.value.ranks.indexOf(t),1)}return watch(user.value,async t=>{await userStore.changeUser(t)}),(t,s)=>(openBlock(),createBlock(VContainer,{class:"mt-1"},{default:withCtx(()=>{var u,m,p,f,h,k,B,w;return[createBaseVNode("div",_hoisted_1,[createVNode(_sfc_main$1),unref(my_page)?(openBlock(),createElementBlock("div",{key:0,onClick:s[0]||(s[0]=(...e)=>unref(auth).logout&&unref(auth).logout(...e)),class:"d-flex pt-1 pr-1 pb-1 cursor-pointer flex-row flex-nowrap align-center justify-start"},[createVNode(VIcon,{icon:"mdi-logout"}),_hoisted_2])):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_3,[createVNode(VAvatar,{image:(u=unref(user))==null?void 0:u.avatar_url,color:"blue",size:"130"},null,8,["image"]),createBaseVNode("div",_hoisted_4,[createBaseVNode("div",_hoisted_5,toDisplayString((m=unref(user))==null?void 0:m.name),1),createBaseVNode("div",_hoisted_6,[createBaseVNode("div",null,toDisplayString(getType()),1),unref(user).ranks&&unref(user).ranks.length!=0?(openBlock(),createElementBlock("div",_hoisted_7,[createBaseVNode("span",null,[createVNode(VIcon,{icon:"mdi-star"})]),createTextVNode(" "+toDisplayString(unref(user).ranks.join(", ")),1)])):createCommentVNode("",!0),unref(user).grade!=0?(openBlock(),createElementBlock("div",_hoisted_8,toDisplayString(unref(user).grade)+" класс",1)):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_9,toDisplayString(unref(town).name+", "+unref(school).name),1),unref(user).description&&unref(user).description.length>0?(openBlock(),createElementBlock("div",_hoisted_10,toDisplayString(unref(user).description),1)):createCommentVNode("",!0),unref(user).contacts&&unref(user).contacts.length>0?(openBlock(),createElementBlock("div",_hoisted_11,[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(user).contacts,e=>(openBlock(),createElementBlock("a",{key:e.link,target:"_blank",href:e.link,style:{"text-decoration":"none"}},[createVNode(VBtn,{size:"small",variant:"tonal",class:"text-body-2 pl-5 pr-5 mr-3 font-weight-semibold bg-button"},{default:withCtx(()=>[createTextVNode(toDisplayString(e.name),1)]),_:2},1024)],8,_hoisted_12))),128))])):createCommentVNode("",!0),unref(my_page)?(openBlock(),createBlock(VBtn,{key:2,size:"small",variant:"tonal",to:"/settings",class:"text-body-2 mt-2 pl-5 pr-5 font-weight-semibold bg-blue"},{default:withCtx(()=>[createTextVNode(" Редактировать профиль "),unref(new_user)?(openBlock(),createBlock(VTooltip,{key:0,location:"bottom start",activator:"parent",color:"gray","model-value":""},{default:withCtx(()=>[createTextVNode(" Привет, новый пользователь! Ты можешь добавить больше информации о себе ")]),_:1})):createCommentVNode("",!0)]),_:1})):createCommentVNode("",!0)])]),(unref(viewer_is_admin)||unref(viewer_is_some_admin))&&!unref(my_page)?(openBlock(),createElementBlock(Fragment,{key:0},[_hoisted_13,createVNode(VCol,{cols:"12",lg:"6"},{default:withCtx(()=>[createVNode(VCombobox,{modelValue:unref(user).ranks,"onUpdate:modelValue":s[1]||(s[1]=e=>unref(user).ranks=e),chips:"",clearable:"",label:"Звания",multiple:"","prepend-icon":"mdi-chevron-triple-up",density:"comfortable",variant:"solo",class:"mt-2","hide-details":""},{selection:withCtx(({attrs:e,item:o,select:n,selected:g})=>[createVNode(VChip,mergeProps(e,{"model-value":g,closable:"",onClick:n,"onClick:close":v=>removeRank(o)}),{default:withCtx(()=>[createBaseVNode("strong",null,toDisplayString(o),1),createTextVNode("  ")]),_:2},1040,["model-value","onClick","onClick:close"])]),_:1},8,["modelValue"])]),_:1}),createVNode(VBtn,{"prepend-icon":"mdi-star"},{default:withCtx(()=>[createTextVNode(" Дать награду ")]),_:1}),createVNode(VBtn,{"prepend-icon":"mdi-delete",class:"bg-red ml-5"},{default:withCtx(()=>[createTextVNode(" Удалить ")]),_:1})],64)):createCommentVNode("",!0),(unref(my_page)||unref(viewer_is_admin))&&unref(entries_on_moderation)&&unref(entries_on_moderation).length>0?(openBlock(),createBlock(VRow,{key:1,class:"flex-column mt-8 w-100"},{default:withCtx(()=>[_hoisted_14,createBaseVNode("div",_hoisted_15,[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(entries_on_moderation),e=>(openBlock(),createBlock(_sfc_main$2,{key:e._id,hide_user:"",entry:e,show_location:!1},null,8,["entry"]))),128))])]),_:1})):createCommentVNode("",!0),unref(my_page)&&!unref(user).roles.includes("mentor")&&unref(responsed_entries)&&unref(responsed_entries).length>0?(openBlock(),createElementBlock(Fragment,{key:2},[_hoisted_16,((p=unref(responsed_mentorship_entries))==null?void 0:p.length)!==0?(openBlock(),createElementBlock("div",_hoisted_17,[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(responsed_mentorship_entries),e=>(openBlock(),createBlock(_sfc_main$2,{key:e==null?void 0:e._id,hide_user:"",entry:e,show_location:!1},null,8,["entry"]))),128))])):createCommentVNode("",!0),((f=unref(responsed_lesson_entries))==null?void 0:f.length)!==0?(openBlock(),createBlock(VRow,{key:1,class:"flex-column pt-4 pb-4 ma-0 pa-0"},{default:withCtx(()=>{var e;return[((e=unref(responsed_mentorship_entries))==null?void 0:e.length)!==0?(openBlock(),createElementBlock("div",_hoisted_18," Уроки ")):createCommentVNode("",!0),createBaseVNode("div",_hoisted_19,[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(responsed_lesson_entries),o=>(openBlock(),createBlock(_sfc_main$2,{key:o._id,hide_user:"",entry:o,show_location:!1},null,8,["entry"]))),128))])]}),_:1})):createCommentVNode("",!0),((h=unref(responsed_club_entries))==null?void 0:h.length)!==0?(openBlock(),createBlock(VRow,{key:2,class:"flex-column pt-4 ma-0 pa-0"},{default:withCtx(()=>{var e,o;return[((e=unref(responsed_mentorship_entries))==null?void 0:e.length)!==0||((o=unref(responsed_lesson_entries))==null?void 0:o.length)!==0?(openBlock(),createElementBlock("div",_hoisted_20,"Клубы")):createCommentVNode("",!0),createBaseVNode("div",_hoisted_21,[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(responsed_club_entries),n=>(openBlock(),createBlock(_sfc_main$2,{key:n._id,hide_user:"",entry:n,show_location:!1},null,8,["entry"]))),128))])]}),_:1})):createCommentVNode("",!0)],64)):createCommentVNode("",!0),unref(user).roles.includes("mentor")||unref(entries)&&unref(entries).length>0?(openBlock(),createElementBlock(Fragment,{key:3},[((k=unref(mentorship_entries))==null?void 0:k.length)!==0?(openBlock(),createBlock(VRow,{key:0,class:"flex-column mt-8 w-100 ma-0 pa-0"},{default:withCtx(()=>[_hoisted_22,createBaseVNode("div",_hoisted_23,[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(mentorship_entries),e=>(openBlock(),createBlock(_sfc_main$2,{key:e._id,hide_user:"",entry:e,show_location:!1},null,8,["entry"]))),128))])]),_:1})):createCommentVNode("",!0),((B=unref(lesson_entries))==null?void 0:B.length)!==0?(openBlock(),createBlock(VRow,{key:1,class:"flex-column mt-8 ma-0 pa-0"},{default:withCtx(()=>[_hoisted_24,createBaseVNode("div",_hoisted_25,[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(lesson_entries),e=>(openBlock(),createBlock(_sfc_main$2,{key:e._id,hide_user:"",entry:e,show_location:!1},null,8,["entry"]))),128))])]),_:1})):createCommentVNode("",!0),((w=unref(club_entries))==null?void 0:w.length)!==0?(openBlock(),createBlock(VRow,{key:2,class:"flex-column mt-8 ma-0 pa-0"},{default:withCtx(()=>[_hoisted_26,createBaseVNode("div",_hoisted_27,[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(club_entries),e=>(openBlock(),createBlock(_sfc_main$2,{key:e._id,hide_user:"",entry:e,show_location:!1},null,8,["entry"]))),128))])]),_:1})):createCommentVNode("",!0)],64)):createCommentVNode("",!0)]}),_:1}))}}),AccountPage_vue_vue_type_style_index_0_scoped_e5d66302_lang="",AccountPage=_export_sfc(_sfc_main,[["__scopeId","data-v-e5d66302"]]);export{AccountPage as default};
