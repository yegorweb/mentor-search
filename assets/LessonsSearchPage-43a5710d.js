import{_ as A}from"./MainTitle.vue_vue_type_script_setup_true_lang-22ce2927.js";import{_ as E}from"./MentorEntry.vue_vue_type_script_setup_true_lang-c2047adc.js";import{d as T,a as B,w as h,r as w,c as f,b as o,g as N,o as c,f as u,k as x,D as p,G as V,j as r,i as S,C as U,p as F,q as L,S as M,F as R,v as q}from"./index-ff565f42.js";import{T as y}from"./TownService-91f9ac4c.js";import{S as D}from"./SchoolService-11bd29f4.js";import{E as C}from"./EntryService-764d1054.js";import"./BackButton.vue_vue_type_script_setup_true_lang-5839fa1f.js";const Q=T({__name:"LessonsSearchPage",async setup(G){let t,d;document.title="Поиск уроков — Ищу наставника";let i=B();function v(e){for(var n,l,_=e.length-1;_>0;_--)n=Math.floor(Math.random()*(_+1)),l=e[n],e[n]=e[_],e[_]=l;return e}let g=([t,d]=h(()=>y.getTowns()),t=await t,d(),t).data,b=([t,d]=h(()=>D.get_all()),t=await t,d(),t).data,s=w(i.getAuthStatus()?i.getUser().town:g.find(e=>e._id==="641c882f9a4751bf88848223")),a=w(i.getAuthStatus()?i.getUser().school:{name:"Все",_id:"all"}),m=w(([t,d]=h(()=>C.get("lesson",s.value._id,a.value._id)),t=await t,d(),t).data.filter(e=>!e.responses.includes(i.getUser()._id)&&e.author._id!==i.getUser()._id&&(e.school._id==a.value._id||e.town._id===s.value._id&&a.value._id==="all")));v(m.value);async function k(){m.value=(await C.get("lesson",s.value._id,a.value._id)).data.filter(e=>!e.responses.includes(i.getUser()._id)&&e.author._id!==i.getUser()._id&&(e.school._id==a.value._id||e.town._id===s.value._id&&a.value._id==="all")),v(m.value)}function j(){return b.filter(e=>e.town._id===s.value._id)}return(e,n)=>(c(),f(N,null,{default:o(()=>[u(A,null,{default:o(()=>[x("Поиск уроков")]),_:1}),u(U,{class:"ma-0 pa-0 mt-4",style:{gap:"12px"}},{default:o(()=>[u(p,{cols:"12",md:"4",sm:"8",xs:"12",class:"ml-0 pa-0"},{default:o(()=>[u(V,{label:"Город",modelValue:r(s),"onUpdate:modelValue":n[0]||(n[0]=l=>S(s)?s.value=l:s=l),items:r(g),"item-title":"name","return-object":"",variant:"solo","hide-details":""},null,8,["modelValue","items"])]),_:1}),u(p,{cols:"12",md:"4",sm:"8",xs:"12",class:"ma-0 pa-0"},{default:o(()=>[u(V,{label:"Школа",modelValue:r(a),"onUpdate:modelValue":[n[1]||(n[1]=l=>S(a)?a.value=l:a=l),k],items:[{name:"Все",_id:"all"},...j()],"item-title":"name","return-object":"",variant:"solo","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1}),u(U,{class:"w-100 mt-5 flex-row flex-wrap"},{default:o(()=>[(c(!0),F(R,null,L(r(m),l=>(c(),f(p,{cols:"12",sm:"6",xs:"12",key:l._id},{default:o(()=>[(c(),f(M,null,{default:o(()=>[u(E,{entry:l,show_location:r(a)._id==="all"},null,8,["entry","show_location"])]),_:2},1024))]),_:2},1024))),128))]),_:1}),r(m).length===0?(c(),f(p,{key:0,cols:"12",sm:"6",xs:"12",class:"text-h6 ma-auto font-weight-medium mt-4 text-center"},{default:o(()=>[x("Уроков нет, или вы на всё откликнулись")]),_:1})):q("",!0)]),_:1}))}});export{Q as default};
