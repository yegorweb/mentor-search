import{d as B,a as M,u as T,w as F,r as v,c as R,b as o,g as E,o as $,f as s,G as A,j as e,i as V,$ as y,Q as D,R as G,T as w,Y as I,a0 as O,M as P,N as Q,I as Y,k as q,D as z,B as H}from"./index-ff565f42.js";import{_ as J}from"./BackButton.vue_vue_type_script_setup_true_lang-5839fa1f.js";import{E as h}from"./EntryService-764d1054.js";import{u as K,a as p}from"./vee-validate.esm-c0140e7f.js";const L=H("div",{class:"text-h5 text-center font-weight-bold"},"Редактирование",-1),te=B({__name:"EditingPage",props:["id"],async setup(_){let n,b;const g=_;let x=M().getUser(),j=T(),u=([n,b]=F(()=>h.get_by_id(g.id)),n=await n,b(),n).data,C=[{name:"Запись",type:"mentor"},{name:"Урок",type:"lesson"},{name:"Клуб",type:"club"}],i=v(u.type),r=v(!!u.limit),c=v(!1);const{meta:S,handleSubmit:N,handleReset:W,validate:U}=K({validationSchema:{subject(l){return!l||l.length<4?"слишком короткий заголовок":l.length>25?"слишком длинный заголовок":!0},description(l){return!l||l.length<20?"слишком короткое описание":l.length>150?"слишком длинное описание":!0},limit(l){return r.value?!l||l.length===0?"заполните поле или уберите лимит":!/^\d+$/.test(l)||!(Number(l)>0)?"неверное значение":Number(l)>300?"многовато":!0:!0}}});let d=p("subject"),m=p("description"),f=p("limit");d.value.value=u.subject,m.value.value=u.description,f.value.value=u.limit;const k=N(async l=>{c.value=!0;let t=Object.assign(l,{});r.value||delete t.limit,console.log(t),await h.edit(g.id,t).then(()=>j.push(`/user/${x._id}`)).finally(()=>c.value=!1)});return(l,t)=>($(),R(E,null,{default:o(()=>[s(J),s(z,{cols:"12",sm:"8",lg:"5",class:"ma-auto"},{default:o(()=>[L,s(A,{label:"Что?",items:e(C),modelValue:e(i),"onUpdate:modelValue":t[0]||(t[0]=a=>V(i)?i.value=a:i=a),"item-title":"name","item-value":"type",variant:"solo",class:"mt-4"},null,8,["items","modelValue"]),s(y,{name:"bounce"},{default:o(()=>[s(D,{onSubmit:G(e(k),["prevent"]),class:"d-flex flex-column align-center justify-center w-100"},{default:o(()=>[s(w,{label:"Заголовок",placeholder:e(i)=="Клуб"?"Клуб любителей Мафии":"Биология",modelValue:e(d).value.value,"onUpdate:modelValue":t[1]||(t[1]=a=>e(d).value.value=a),"error-messages":e(d).errorMessage.value,variant:"solo",class:"w-100"},null,8,["placeholder","modelValue","error-messages"]),s(I,{label:"Описание",modelValue:e(m).value.value,"onUpdate:modelValue":t[2]||(t[2]=a=>e(m).value.value=a),"error-messages":e(m).errorMessage.value,counter:150,variant:"solo",class:"w-100"},null,8,["modelValue","error-messages"]),s(O,{label:"Лимит учеников",modelValue:e(r),"onUpdate:modelValue":t[3]||(t[3]=a=>V(r)?r.value=a:r=a),onClick:t[4]||(t[4]=a=>e(U)()),class:"w-100","hide-details":""},null,8,["modelValue"]),s(y,{name:"bounce"},{default:o(()=>[P(s(w,{type:"number",variant:"solo",label:"Сколько?",modelValue:e(f).value.value,"onUpdate:modelValue":t[5]||(t[5]=a=>e(f).value.value=a),"error-messages":e(f).errorMessage.value,class:"w-100 mb-3"},null,8,["modelValue","error-messages"]),[[Q,e(r)]])]),_:1}),s(Y,{color:"accent",disabled:!e(S).valid,type:"submit",loading:e(c)},{default:o(()=>[q("Отправить")]),_:1},8,["disabled","loading"])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1}))}});export{te as default};
