import{d as I,o as i,c as f,e as t,j as r,l as e,i as W,u as X,a as Y,w as U,r as w,H as T,g as ee,f as a,h as x,M as p,R as C,D as _,E as k,k as b,Z as F,_ as M,A,J as ae,$ as R,Q as te,T as N,U as D,v as H,B as le,C as se,x as $,F as oe}from"./index-2a8a9a72.js";import{_ as ne}from"./MainTitle.vue_vue_type_script_setup_true_lang-30294ea4.js";import{u as j}from"./school-d02373ea.js";import{u as E,a as B}from"./vee-validate.esm-1e1674fa.js";import"./BackButton.vue_vue_type_script_setup_true_lang-c7282861.js";const G=I({__name:"CloseButton",props:{modelValue:{type:Boolean,required:!0,default:null}},emits:["update:modelValue"],setup(q,{emit:n}){return(m,c)=>(i(),f(W,{onClick:c[0]||(c[0]=v=>e(n)("update:modelValue",!1)),class:"pa-4",style:{position:"absolute",top:"4px",right:"4px"}},{default:t(()=>[r(" mdi-close ")]),_:1}))}}),ue={class:"d-flex flex-column align-start mt-6"},de=x("div",{class:"text-h6 text-center font-weight-bold ma-auto"}," Создать школу ",-1),re=x("div",{class:"text-h6 text-center font-weight-bold ma-auto"}," Создать город ",-1),ie=x("div",{class:"text-h5 mb-4 font-weight-bold mt-8"}," Ваши школы ",-1),Ve=I({__name:"Index",async setup(q){let n,m,c=X(),v=Y().user,J=([n,m]=U(()=>j().get_administered_schools()),n=await n,m(),n),u=w(!1),h=w(!1);const{meta:L,handleSubmit:Q}=E({initialValues:{town_name:""},validationSchema:{town_name(o){return o.trim().length<2?"короткое название":!0}}});let V=B("town_name");const Z=Q(async o=>{h.value=!0,await T().create(o.town_name.trim()),h.value=!1,u.value=!1,V.value.value=""});let d=w(!1),y=w(!1),z=([n,m]=U(()=>T().getAdministeredTowns()),n=await n,m(),n);const{meta:K,handleSubmit:O}=E({initialValues:{town_id:"",school_name:""},validationSchema:{town_id(o){return o?!0:"выберите город"},school_name(o){return o.trim().length<3?"короткое название":!0}}});let S=B("town_id"),g=B("school_name");const P=O(async o=>{y.value=!0,await j().create(o.school_name.trim(),o.town_id),y.value=!1,d.value=!1,g.value.value=""});return(o,s)=>(i(),f(ee,null,{default:t(()=>[a(ne,null,{default:t(()=>[r("Управление")]),_:1}),x("div",ue,[a(p,{onClick:s[0]||(s[0]=l=>e(c).push("/admin/moderation")),"prepend-icon":"mdi-check"},{default:t(()=>[r(" Модерация ")]),_:1}),e(C).isTownAdmin(e(v).roles)||e(C).isGlobalAdmin(e(v).roles)?(i(),f(p,{key:0,"prepend-icon":"mdi-school",class:"mt-3"},{default:t(()=>[r(" Создать школу "),a(D,{modelValue:e(d),"onUpdate:modelValue":s[4]||(s[4]=l=>b(d)?d.value=l:d=l),activator:"parent"},{default:t(()=>[a(_,{cols:"12",sm:"8",md:"6",lg:"5",xl:"4",class:"ma-auto ma-0 pa-0"},{default:t(()=>[a(k,{class:"pa-5 pt-4 pb-4 rounded-lg",style:{position:"relative"}},{default:t(()=>[a(G,{modelValue:e(d),"onUpdate:modelValue":s[1]||(s[1]=l=>b(d)?d.value=l:d=l)},null,8,["modelValue"]),de,a(F,{onSubmit:M(e(P),["prevent"]),class:"mt-3"},{default:t(()=>[a(A,{class:"flex-row flex-wrap",style:{margin:"0 -2px"}},{default:t(()=>[a(_,{cols:"12",md:"6",style:{padding:"0 2px"}},{default:t(()=>[a(ae,{modelValue:e(S).value.value,"onUpdate:modelValue":s[2]||(s[2]=l=>e(S).value.value=l),"error-messages":e(S).errors.value,items:e(z),"item-title":"name","item-value":"_id","auto-select-first":"","return-object":"",label:"Город",variant:"outlined",density:"compact"},null,8,["modelValue","error-messages","items"])]),_:1}),a(_,{cols:"12",md:"6",style:{padding:"0 2px"}},{default:t(()=>[a(R,{modelValue:e(g).value.value,"onUpdate:modelValue":s[3]||(s[3]=l=>e(g).value.value=l),"error-messages":e(g).errorMessage.value,variant:"outlined",label:"Название",placeholder:"Гимназия 8",density:"compact"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),a(te,null,{default:t(()=>[a(N),a(p,{type:"submit",class:"bg-accent",loading:e(y),disabled:!e(K).valid},{default:t(()=>[r(" Создать ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})):H("",!0),e(C).isGlobalAdmin(e(v).roles)?(i(),f(p,{key:1,"prepend-icon":"mdi-town-hall",class:"mt-3"},{default:t(()=>[r(" Создать город "),a(D,{modelValue:e(u),"onUpdate:modelValue":s[7]||(s[7]=l=>b(u)?u.value=l:u=l),activator:"parent"},{default:t(()=>[a(_,{cols:"12",sm:"8",md:"6",lg:"5",xl:"4",class:"ma-auto ma-0 pa-0"},{default:t(()=>[a(k,{class:"pa-5 pt-4 pb-4 rounded-lg",style:{position:"relative"}},{default:t(()=>[a(G,{modelValue:e(u),"onUpdate:modelValue":s[5]||(s[5]=l=>b(u)?u.value=l:u=l)},null,8,["modelValue"]),re,a(F,{onSubmit:M(e(Z),["prevent"]),class:"mt-3"},{default:t(()=>[a(R,{modelValue:e(V).value.value,"onUpdate:modelValue":s[6]||(s[6]=l=>e(V).value.value=l),"error-messages":e(V).errorMessage.value,variant:"outlined",label:"Название",placeholder:"Глазов",density:"compact"},null,8,["modelValue","error-messages"]),a(A,{class:"flex-row w-100 ma-0 pa-0"},{default:t(()=>[a(N),a(p,{type:"submit",class:"bg-accent",loading:e(h),disabled:!e(L).valid},{default:t(()=>[r(" Создать ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})):H("",!0)]),ie,a(A,{class:"mt-1"},{default:t(()=>[(i(!0),le(oe,null,se(e(J),l=>(i(),f(_,{key:l._id,cols:"12",md:"4",sm:"6"},{default:t(()=>[a(k,{onClick:me=>e(c).push(`/admin/school/${l._id}`),class:"text-center align-center pa-4"},{default:t(()=>[r($(l.town.name)+", "+$(l.name),1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]),_:1}))}});export{Ve as default};
