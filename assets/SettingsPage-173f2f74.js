import{d as X,a as Y,u as Z,r as c,w as P,K as J,c as x,b as t,g as ee,o as V,f as l,D as u,T as le,U as te,j as a,B as v,i as f,W as B,X as ae,Y as se,C as r,Z as F,_ as oe,$ as D,a0 as ne,a1 as ie,p as ue,q as de,L as I,h as re,k as R,F as me,v as E,t as ce,H as T,P as fe,Q as pe}from"./index-a7c02cab.js";import{_ as ve}from"./BackButton.vue_vue_type_script_setup_true_lang-b11ea951.js";import{E as A}from"./EntryContainer-86434311.js";import{u as ge,a as j}from"./vee-validate.esm-ef4f8042.js";import{u as _e}from"./town-8d6ffef6.js";import{u as be}from"./school-bdd1772f.js";import{_ as Ve}from"./_plugin-vue_export-helper-c27b6911.js";const we=w=>(fe("data-v-ce0f8185"),w=w(),pe(),w),he={class:"d-flex flex-column"},ye=we(()=>v("div",{class:"text-body-1 mb-2 font-weight-bold"},"Контакты",-1)),ke={class:"text-body-2 text-red"},xe=X({__name:"SettingsPage",async setup(w){let d,h;localStorage.setItem("newUser","false"),document.title="Натройки — Ищу наставника";let M=Y();Z();let n=M.getUser(),i=c(1),S=c(!1),G=_e(),L=be(),q=([d,h]=P(()=>G.get_all()),d=await d,h(),d),C=([d,h]=P(()=>L.get_all()),d=await d,h(),d);function z(){return C==null?void 0:C.filter(o=>o.town._id===p.value._id)}function H(){let o=[{digit:"—",number:0}];for(let e=1;e<=11;e++)o.push({digit:e.toString(),number:e});return o}const{meta:K,handleSubmit:O,handleReset:Se}=ge({initialValues:{name:n.name,description:n.description,contacts:n.contacts?n.contacts:[]},validationSchema:{name(o){return!o||o.length<4?"слишком короткое имя":o.length>21?"слишком длинное имя":!0},description(o){return o&&o.length>150?"слишком длинное описание":!0},contacts(o){for(let e of o){if(!e.name||e.name.length===0||!e.link||e.link.length===0)return"в каждом контакте должны быть название и ссылка";if(e.name.length>15)return"слишком длинное название в контакте";if(e.link.length>200)return"кажется тут слишком длинная ссылка"}return!0}}}),Q=O(async o=>{S.value=!0,await M.updateUser(Object.assign(o,{town:p.value._id,school:_.value._id,grade:b.value,roles:y.value})).then(()=>window.location.href=`/user/${n==null?void 0:n._id}`).finally(()=>S.value=!1)});let g=c(n==null?void 0:n.roles.includes("mentor"));J(g,o=>{o?y.value.push("mentor"):y.value=y.value.filter(e=>e!=="mentor")});let U=j("name"),$=j("description"),m=j("contacts"),p=c(n.town),_=c(n.school),b=c(n.grade),y=c(n.roles);return(o,e)=>(V(),x(ee,null,{default:t(()=>[l(ve),l(r,{class:"mt-1 align-start"},{default:t(()=>[l(u,{cols:"12",md:"5",lg:"4",xl:"3"},{default:t(()=>[le(l(A,null,{default:t(()=>[v("div",he,[v("div",{onClick:e[0]||(e[0]=s=>f(i)?i.value=1:i=1),class:B(`cursor-pointer pt-1 pb-1 font-weight-semibold ${a(i)!==1?"text-teal-darken-1":""}`)},"Редактрировать профиль",2),v("div",{onClick:e[1]||(e[1]=s=>f(i)?i.value=2:i=2),class:B(`cursor-pointer pt-1 pb-1 font-weight-semibold ${a(i)!==2?"text-teal-darken-1":""}`)},"Изменить пароль",2),v("div",{onClick:e[2]||(e[2]=s=>f(i)?i.value=3:i=3),class:B(`cursor-pointer pt-1 pb-1 font-weight-semibold ${a(i)!==3?"text-teal-darken-1":""}`)},"Мои подписки",2)])]),_:1},512),[[te,a(i)===1]])]),_:1}),l(u,null,{default:t(()=>[a(i)===1?(V(),x(A,{key:0},{default:t(()=>[l(ae,{onSubmit:se(a(Q),["prevent"])},{default:t(()=>[l(r,{class:"mt-1"},{default:t(()=>[l(u,{cols:"12",sm:"6"},{default:t(()=>[l(F,{label:"Имя Фамилия",modelValue:a(U).value.value,"onUpdate:modelValue":e[3]||(e[3]=s=>a(U).value.value=s),"error-messages":a(U).errorMessage.value,placeholder:"Василий Петров",variant:"outlined",density:"comfortable"},null,8,["modelValue","error-messages"])]),_:1}),l(u,{cols:"12",sm:"6"},{default:t(()=>[l(oe,{label:"Кто вы?",modelValue:a(g),"onUpdate:modelValue":e[4]||(e[4]=s=>f(g)?g.value=s:g=s),"hide-details":"",column:""},{default:t(()=>[l(D,{label:"Наставляемый",value:!1}),l(D,{label:"Наставник",value:!0})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(r,null,{default:t(()=>[l(u,{cols:"12",sm:"6"},{default:t(()=>[l(ne,{label:"Описание",modelValue:a($).value.value,"onUpdate:modelValue":e[5]||(e[5]=s=>a($).value.value=s),"error-messages":a($).errorMessage.value,counter:150,variant:"outlined",class:"w-100"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),l(r,null,{default:t(()=>[l(u,{cols:"12"},{default:t(()=>[l(r,{class:"flex-column align-start ma-0 pa-0"},{default:t(()=>[ye,a(m).value.value.length>0?(V(),x(r,{key:0,class:"flex-column mb-2 ma-0 pa-0 w-100",style:{gap:"6px"}},{default:t(()=>[l(ie,{name:"list"},{default:t(()=>[(V(!0),ue(me,null,de(a(m).value.value,(s,N)=>(V(),x(r,{class:"flex-row justify-space-between align-stretch ma-0 pa-0",key:N},{default:t(()=>[l(F,{placeholder:"ВКонтакте",modelValue:s.name,"onUpdate:modelValue":k=>s.name=k,variant:"outlined",density:"compact",class:"w-30","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),l(F,{placeholder:"vk.com/vasiliy",modelValue:s.link,"onUpdate:modelValue":k=>s.link=k,variant:"outlined",density:"compact",class:"ml-2","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),l(I,{variant:"tonal",onClick:k=>a(m).value.value=a(m).value.value.filter((Ce,W)=>W!==N),class:"ml-2 font-weight-semibold bg-button"},{default:t(()=>[l(re,null,{default:t(()=>[R("mdi-delete")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]),_:1})):E("",!0),v("div",ke,ce(a(m).errorMessage.value),1),l(I,{"prepend-icon":"mdi-plus",variant:"tonal",disabled:a(m).value.value.length>3,onClick:e[6]||(e[6]=s=>a(m).value.value.push({name:"",link:"http://"})),class:"text-body-2 pl-5 pr-5 font-weight-semibold bg-button"},{default:t(()=>[R("Добавить")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),l(r,{class:"mt-8"},{default:t(()=>[l(u,{cols:"12",sm:"6"},{default:t(()=>[l(T,{label:"Город",modelValue:a(p),"onUpdate:modelValue":e[7]||(e[7]=s=>f(p)?p.value=s:p=s),items:a(q),"item-title":"name","return-object":"",density:"comfortable",variant:"outlined",class:"w-100","hide-details":""},null,8,["modelValue","items"])]),_:1}),l(u,{cols:"12",sm:"6"},{default:t(()=>[l(T,{label:"Школа",modelValue:a(_),"onUpdate:modelValue":e[8]||(e[8]=s=>f(_)?_.value=s:_=s),items:z(),"item-title":"name","return-object":"",density:"comfortable",variant:"outlined",class:"w-100","hide-details":""},null,8,["modelValue","items"])]),_:1}),l(u,{cols:"12",sm:"6"},{default:t(()=>[l(T,{label:"Класс",modelValue:a(b),"onUpdate:modelValue":e[9]||(e[9]=s=>f(b)?b.value=s:b=s),items:H(),"item-title":"digit","item-value":"number",density:"comfortable",variant:"outlined",class:"w-100","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1}),l(I,{type:"submit",loading:a(S),disabled:!a(K).valid,class:"bg-accent mb-2 mt-8"},{default:t(()=>[R(" Сохранить ")]),_:1},8,["loading","disabled"])]),_:1},8,["onSubmit"])]),_:1})):E("",!0)]),_:1})]),_:1})]),_:1}))}});const je=Ve(xe,[["__scopeId","data-v-ce0f8185"]]);export{je as default};
