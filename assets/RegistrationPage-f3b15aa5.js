import{d as E,u as N,a as T,H as O,r as w,w as q,I as D,b as G,c as H,e as u,g as I,o as J,f as s,E as M,Z as P,l as e,$ as V,J as U,a4 as Z,a0 as z,k as K,a1 as S,a6 as L,h as _,j as b,M as Q,D as W}from"./index-4f6c5d65.js";import{_ as X}from"./BackButton.vue_vue_type_script_setup_true_lang-603e5d2f.js";import{u as Y,a as o}from"./vee-validate.esm-0f4ff9e4.js";import{u as ee}from"./school-9a21f72d.js";import{_ as le}from"./lodash-57ff8d49.js";const ae=_("div",{class:"text-h6 font-weight-bold"}," Регистрация ",-1),te={class:"text-start"},ve=E({__name:"RegistrationPage",async setup(se){let i,h;document.title="Регистрация — Ищу наставника";let k=N(),d=T(),y=ee(),{towns:R}=O();function j(){let l=[{digit:"—",number:0}];for(let a=1;a<=11;a++)l.push({digit:a.toString(),number:a});return l}const{meta:B,handleSubmit:F,handleReset:re,validate:ue}=Y({initialValues:{name:"",email:"",password:"",town:null,school:null,grade:0,agree:!0},validationSchema:{name(l){return l.length===0?"введите фамилию, имя":l.length<4?"слишком короткое имя и фамилия":l.length>22?"слишком длинное имя и фамилия":!0},email(l){return l.length===0?"введите почту":/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/.test(l)?!0:"неправильно ведено"},password(l){return l.length===0?"введите пароль":l.length<8?"минимум 8 символов":l.length>30?"слишком длинный пароль":!0},town(l){return l?!0:"укажите свой город"},school(l){return l?!0:"укажите свою школу"},grade(l){return!0},agree(l){return l?!0:"нужно ваше соглашение"}}});let v=o("name"),p=o("email"),g=o("password"),r=o("town"),m=o("school"),c=o("grade"),f=o("agree"),n=w(!1),x=w(r.value.value?([i,h]=q(()=>y.get_all_in_town(r.value.value._id)),i=await i,h(),i):[]);D(r.value,async(l,a)=>{le.isEqual(l,a)||(m.value.value=null,x.value=r.value.value?await y.get_all_in_town(r.value.value._id):[])});let C=w(!1);const $=F(async l=>{C.value=!0,await d.registration(Object.assign(l,{roles:["student",n.value?"mentor":null]})),C.value=!1,window.location.href=d.user?`/user/${d.user._id}`:"/"});return(l,a)=>{const A=G("router-link");return J(),H(I,null,{default:u(()=>[s(X),s(W,{cols:"12",xs:"12",sm:"10",md:"7",lg:"5",class:"mt-4 ma-auto"},{default:u(()=>[s(M,{class:"d-flex flex-column justify-center align-center text-center w-100 pl-6 pr-6 pt-4 pb-6 rounded-lg"},{default:u(()=>[ae,s(P,{class:"mt-6 w-100",onSubmit:e($)},{default:u(()=>[s(V,{label:"Имя Фамилия",type:"name",placeholder:"Иван Иванов",modelValue:e(v).value.value,"onUpdate:modelValue":a[0]||(a[0]=t=>e(v).value.value=t),"error-messages":e(v).errors.value,variant:"outlined",density:"compact",class:"w-100"},null,8,["modelValue","error-messages"]),s(V,{label:"Email",type:"email",placeholder:"vasya@ya.ru",modelValue:e(p).value.value,"onUpdate:modelValue":a[1]||(a[1]=t=>e(p).value.value=t),"error-messages":e(p).errors.value,variant:"outlined",density:"compact",class:"w-100 mt-1"},null,8,["modelValue","error-messages"]),s(V,{label:"Пароль",type:"password",modelValue:e(g).value.value,"onUpdate:modelValue":a[2]||(a[2]=t=>e(g).value.value=t),"error-messages":e(g).errors.value,variant:"outlined",density:"compact",class:"w-100 mt-1"},null,8,["modelValue","error-messages"]),s(U,{label:"Город",modelValue:e(r).value.value,"onUpdate:modelValue":a[3]||(a[3]=t=>e(r).value.value=t),"error-messages":e(r).errors.value,items:e(R),"auto-select-first":"","return-object":"","item-title":"name",variant:"outlined",density:"compact",class:"w-100 mt-1"},null,8,["modelValue","error-messages","items"]),s(U,{label:"Школа",modelValue:e(m).value.value,"onUpdate:modelValue":a[4]||(a[4]=t=>e(m).value.value=t),disabled:!e(r).value.value,"error-messages":e(m).errors.value,items:e(x),"auto-select-first":"","item-title":"name","return-object":"",variant:"outlined",density:"compact",class:"w-100 mt-1"},null,8,["modelValue","disabled","error-messages","items"]),s(Z,{label:"Класс",modelValue:e(c).value.value,"onUpdate:modelValue":a[5]||(a[5]=t=>e(c).value.value=t),"error-messages":e(c).errors.value,items:j(),"auto-select-first":"","item-title":"digit","item-value":"number",variant:"outlined",density:"compact",class:"w-100 mt-1"},null,8,["modelValue","error-messages","items"]),s(z,{modelValue:e(n),"onUpdate:modelValue":a[6]||(a[6]=t=>K(n)?n.value=t:n=t),label:"Кто вы?","hide-details":"",class:"mt-2",column:""},{default:u(()=>[s(S,{label:"Наставляемый",value:!1}),s(S,{label:"Наставник",value:!0})]),_:1},8,["modelValue"]),s(L,{modelValue:e(f).value.value,"onUpdate:modelValue":a[7]||(a[7]=t=>e(f).value.value=t),"error-messages":e(f).errors.value,class:"w-100 mt-4 ma-0 pa-0 align-start"},{label:u(()=>[_("div",te,[b(" Принимаю "),s(A,{to:"/termsOfUse"},{default:u(()=>[b("пользовательское соглашение")]),_:1})])]),_:1},8,["modelValue","error-messages"]),s(Q,{type:"submit",disabled:!e(B).valid,color:"accent",class:"mt-6"},{default:u(()=>[b(" Отправить ")]),_:1},8,["disabled"])]),_:1},8,["onSubmit"]),_("div",{onClick:a[8]||(a[8]=t=>e(k).push("/login")),class:"text-subtitle-1 w-100 cursor-pointer font-weight-semibold pa-1 mt-2"}," вход ")]),_:1})]),_:1})]),_:1})}}});export{ve as default};
