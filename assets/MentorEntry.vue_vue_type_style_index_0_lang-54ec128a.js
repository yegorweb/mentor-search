import{d as ee,u as te,I as le,r as c,a as se,w as ae,R as $,o as a,c as _,b as l,B as r,j as e,C as E,f as o,l as oe,t as f,p,v as i,F as U,h as L,k as d,L as g,W as ne,g as ie,E as re,i as F,q as de,D as ue,a6 as ce,a4 as fe,a7 as _e,y as pe,s as H,n as me}from"./index-a7c02cab.js";import{u as ge}from"./entry-0acbcb40.js";import{E as ye}from"./EntryContainer-86434311.js";const ve={class:"d-flex align-start w-100 justify-start flex-column"},he={class:"d-flex ml-4 flex-column justify-start"},we={style:{"line-height":"1.2"},class:"font-author font-weight-semibold"},xe={key:0,class:"text-gray lh-1 text-body-2"},be={style:{"column-gap":"16px"},class:"d-flex align-center flex-row flex-wrap mr-4"},ke={class:"text-h6 font-weight-black"},Ce={class:"text-body font-weight-regular"},Ve={class:"text-body font-weight-regular"},je=["innerHTML"],ze={class:"d-flex mt-5 flex-column justify-start"},Ae={key:0,class:"mb-2"},Be={key:0},$e={style:{"row-gap":"6px"},class:"d-flex flex-row flex-wrap justify-start align-center"},Ee={class:"d-flex flex-row flex-lg-column ma-auto ma-sm-0 pa-0 align-center align-lg-end",style:{"column-gap":"8px","row-gap":"4px"}},Le={key:3,class:"text-body font-weight-regular"},Se={key:1,style:{"row-gap":"6px"},class:"d-flex mt-2 flex-row flex-wrap justify-start align-center"},Me={key:2,class:"mt-2 w-100 text-red"},Te=ee({__name:"MentorEntry",props:{entry:{type:Object,required:!0},show_location:{type:Boolean,required:!1,default:!1},hide_user:{type:Boolean,required:!1,default:!1}},async setup(P){let w,S;const x=P;let M=te(),G=le(),m=c(!1),R=se(),s=R.getUser(),W=R.getAuthStatus(),v=ge(),t=c(x.entry),J=([w,S]=ae(async()=>Promise.all(t.value.responses.map(async h=>await G.get_by_id(h)))),w=await w,S(),w),b=c(!1),C=c(!1),k=c(s&&t.value.responses.includes(s._id)),y=s&&t.value.author._id===s._id,q=s&&($.isAdminOfSchool(s.roles,t.value.school._id)||$.isAdminOfTown(s.roles,t.value.town._id)||$.isGlobalAdmin(s.roles)),V=c(k.value?"Убрать отклик":"Откликнуться");async function K(){if(s){if(b.value=!0,t.value.responses.includes(s._id)){await v.cancel_response(t.value._id).then(()=>{t.value.responses=t.value.responses.filter(h=>h!==(s==null?void 0:s._id)),V.value="Откликнуться",k.value=!1}).finally(()=>b.value=!1);return}await v.response(t.value._id).then(()=>{t.value.responses.push(s._id),V.value="Убрать отклик",k.value=!0}).finally(()=>b.value=!1)}}async function Q(){C.value=!0,await v.delete_entry(t.value._id).finally(()=>C.value=!1)}let j=c(!1),z=c(!1),A=c(!1),B=c(!1);async function X(){j.value=!0,await v.verify(t.value._id,!0).then(()=>{z.value=!0,B.value=!1}).finally(()=>j.value=!1)}async function Y(){A.value=!0,await v.verify(t.value._id,!1).then(()=>{B.value=!0,z.value=!1}).finally(()=>A.value=!1)}return(h,u)=>(a(),_(ye,{class:"justify-space-between",style:{position:"relative"}},{default:l(()=>{var N,T,D,I,O;return[r("div",ve,[e(x).hide_user?i("",!0):(a(),_(E,{key:0,onClick:u[0]||(u[0]=n=>e(M).push(`/user/${e(t).author._id}`)),class:"flex-row ma-0 mb-2 pa-0 flex-nowrap align-center justify-start cursor-pointer"},{default:l(()=>{var n;return[o(oe,{image:e(t).author.avatar_url,color:"blue"},null,8,["image"]),r("div",he,[r("div",we,f(e(t).author.name),1),e(t).author.ranks.length>0?(a(),p("div",xe,f((n=e(t).author.ranks)==null?void 0:n.join(", ")),1)):i("",!0)])]}),_:1})),r("div",be,[r("div",ke,f(e(t).subject),1),e(t).limit?(a(),p(U,{key:0},[r("div",Ce,f(e(t).limit)+" чел.",1),r("div",Ve,"осталось: "+f(e(t).limit-e(t).responses.length),1)],64)):i("",!0)]),r("div",{class:"mt-1",innerHTML:e(t).description},null,8,je)]),r("div",ze,[e(t).town._id!=((T=(N=e(s))==null?void 0:N.town)==null?void 0:T._id)||e(t).school._id!=((I=(D=e(s))==null?void 0:D.school)==null?void 0:I._id)||e(x).show_location?(a(),p("div",Ae,[r("span",null,[o(L,{icon:"mdi-map-marker",class:"mr-1",color:"teal-lighten-1"})]),e(t).town._id!==((O=e(s))==null?void 0:O.town._id)?(a(),p("span",Be,f(e(t).town.name+", "),1)):i("",!0),d(f(e(t).school.name),1)])):i("",!0),r("div",$e,[!e(y)&&!e(t).on_moderation?(a(),_(g,{key:0,onClick:K,loading:e(b),disabled:!e(W)||(e(t).limit?e(t).limit-e(t).responses.length===0:!1),size:"small",variant:"tonal",class:ne(`text-body-2 pl-5 pr-5 mr-3 font-weight-semibold ${e(k)?"bg-accent":"bg-button"}`)},{default:l(()=>[d(f(e(V)),1)]),_:1},8,["loading","disabled","class"])):i("",!0),e(x).hide_user?i("",!0):(a(),_(g,{key:1,size:"small",to:`/user/${e(t).author._id}`,variant:"tonal",class:"text-body-2 pl-5 pr-5 font-weight-semibold bg-button"},{default:l(()=>[d("Посмотреть профиль")]),_:1},8,["to"])),e(y)&&e(t).responses.length>0?(a(),_(g,{key:2,size:"small",variant:"tonal",class:"text-body-2 pl-5 pr-5 mr-3 font-weight-semibold bg-button",onClick:u[3]||(u[3]=n=>h.responses=e(t).responses)},{default:l(()=>[d(" Посмотреть отклики ("+f(e(t).responses.length)+") ",1),o(fe,{modelValue:e(m),"onUpdate:modelValue":u[2]||(u[2]=n=>F(m)?m.value=n:m=n),activator:"parent",scrollable:"",class:"align-center"},{default:l(()=>[o(ie,null,{default:l(()=>[o(re,{style:{"min-height":"83vh"},class:"rounded-lg w-100 ma-auto"},{default:l(()=>[o(L,{onClick:u[1]||(u[1]=n=>F(m)?m.value=!1:m=!1),style:{position:"absolute",top:"7px",right:"7px"}},{default:l(()=>[d(" mdi-close ")]),_:1}),o(E,{class:"flex-row flex-wrap pa-8"},{default:l(()=>[(a(!0),p(U,null,de(e(J),(n,Z)=>(a(),_(ue,{key:Z,cols:"12",lg:"6"},{default:l(()=>[o(E,{class:"align-center h-100 ma-0 response d-flex flex-column flex-sm-row",style:{gap:"10px"}},{default:l(()=>[o(ce,{user:n},null,8,["user"]),r("div",Ee,[o(g,{size:"small",variant:"tonal",class:"text-body-2 pl-5 pr-5 font-weight-semibold bg-button"},{default:l(()=>[d(" Заблокировать ")]),_:1}),o(g,{size:"small",variant:"tonal",class:"text-body-2 pl-5 pr-5 font-weight-semibold bg-button"},{default:l(()=>[d(" Убрать отклик ")]),_:1})])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})):i("",!0),e(t).responses.length===0&&e(y)&&!e(t).on_moderation&&e(t).moderation_result?(a(),p("div",Le,"Откликов нет")):i("",!0)]),e(q)&&e(t).on_moderation?(a(),p("div",Se,[o(g,{size:"small",variant:"tonal",class:"text-body-2 mr-3 pl-5 pr-5 font-weight-semibold bg-light-green-darken-2",onClick:X,loading:e(j),disabled:e(z)},{default:l(()=>[d("Принять")]),_:1},8,["loading","disabled"]),o(g,{size:"small",variant:"tonal",class:"text-body-2 pl-5 pr-5 font-weight-semibold bg-red",onClick:Y,loading:e(A),disabled:e(B)},{default:l(()=>[d("Отказать")]),_:1},8,["loading","disabled"])])):i("",!0),e(y)&&!e(t).on_moderation&&!e(t).moderation_result?(a(),p("div",Me," Ваша запись не одобрена администратором. Отредактируйте запись, чтобы отправить отправить на проверку снова ")):i("",!0)]),e(y)||e(q)?(a(),_(_e,{key:0,location:"start"},{activator:l(({props:n})=>[o(L,pe({class:"pa-4",style:{position:"absolute",right:"12px",top:"12px"},icon:"mdi-dots-vertical"},n),null,16)]),default:l(()=>[o(me,{density:"compact"},{default:l(()=>[e(y)?(a(),_(H,{key:0,"prepend-icon":"mdi-pencil",onClick:u[4]||(u[4]=n=>e(M).push(`/edit/${e(t)._id}`))},{default:l(()=>[d(" Редактировать ")]),_:1})):i("",!0),o(H,{"prepend-icon":"mdi-delete",onClick:Q,loading:e(C)},{default:l(()=>[d(" Удалить ")]),_:1},8,["loading"])]),_:1})]),_:1})):i("",!0)]}),_:1}))}});export{Te as _};
