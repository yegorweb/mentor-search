import{d as k,o as i,c as p,b as e,k as u,j as t,h as A,u as N,a as T,w as U,r as b,g as $,f as a,D as c,L as V,R as D,a4 as q,i as x,E as C,X as E,Y as L,Z as M,C as g,a5 as j,v as G,p as I,q as P,t as h,F as X,B as y}from"./index-a7c02cab.js";import{_ as Y}from"./MainTitle.vue_vue_type_script_setup_true_lang-5e97d381.js";import{u as Z}from"./school-bdd1772f.js";import{u as z}from"./town-8d6ffef6.js";import{u as H,a as J}from"./vee-validate.esm-ef4f8042.js";import"./BackButton.vue_vue_type_script_setup_true_lang-b11ea951.js";const K=k({__name:"CloseButton",props:{modelValue:{type:Boolean,required:!0,default:null}},emits:["update:modelValue"],setup(B,{emit:n}){return(_,r)=>(i(),p(A,{onClick:r[0]||(r[0]=v=>t(n)("update:modelValue",!1)),class:"pa-4",style:{position:"absolute",top:"4px",right:"4px"}},{default:e(()=>[u(" mdi-close ")]),_:1}))}}),O=y("div",{class:"text-h6 text-center font-weight-bold ma-auto"}," Создание города ",-1),Q=y("div",{class:"text-h5 mb-4 font-weight-bold mt-8"},"Ваши школы",-1),ne=k({__name:"AdminPage",async setup(B){let n,_,r=N(),v=T().getUser(),S=([n,_]=U(()=>Z().get_administered_schools()),n=await n,_(),n),s=b(!1),f=b(!1);const{meta:F,handleSubmit:R}=H({initialValues:{town_name:""},validationSchema:{town_name(m){return m.length<2?"короткое название":!0}}});let d=J("town_name");const w=R(async m=>{f.value=!0,await z().create(m.town_name).then(()=>{d.value.value="",s.value=!1}).finally(()=>{f.value=!1})});return(m,o)=>(i(),p($,null,{default:e(()=>[a(Y,null,{default:e(()=>[u("Управление")]),_:1}),a(g,{class:"flex-column"},{default:e(()=>[a(c,null,{default:e(()=>[a(V,{"prepend-icon":"mdi-check",onClick:o[0]||(o[0]=l=>t(r).push("/admin/moderation")),class:"mt-6"},{default:e(()=>[u(" Модерация ")]),_:1})]),_:1}),t(D).isGlobalAdmin(t(v).roles)?(i(),p(c,{key:0},{default:e(()=>[a(V,null,{default:e(()=>[u(" Создать город "),a(q,{modelValue:t(s),"onUpdate:modelValue":o[3]||(o[3]=l=>x(s)?s.value=l:s=l),activator:"parent"},{default:e(()=>[a(c,{cols:"12",sm:"8",md:"6",lg:"5",xl:"4",class:"ma-auto ma-0 pa-0"},{default:e(()=>[a(C,{class:"pa-5 pt-4 pb-4 rounded-lg",style:{position:"relative"}},{default:e(()=>[a(K,{modelValue:t(s),"onUpdate:modelValue":o[1]||(o[1]=l=>x(s)?s.value=l:s=l)},null,8,["modelValue"]),O,a(E,{onSubmit:L(t(w),["prevent"]),class:"mt-3"},{default:e(()=>[a(M,{modelValue:t(d).value.value,"onUpdate:modelValue":o[2]||(o[2]=l=>t(d).value.value=l),"error-messages":t(d).errorMessage.value,variant:"outlined",label:"Название",placeholder:"Глазов",density:"comfortable"},null,8,["modelValue","error-messages"]),a(g,{class:"flex-row w-100 ma-0 pa-0"},{default:e(()=>[a(j),a(V,{type:"submit",class:"bg-accent",onClick:t(w),loading:t(f),disabled:!t(F).valid},{default:e(()=>[u(" Создать ")]),_:1},8,["onClick","loading","disabled"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})):G("",!0)]),_:1}),Q,a(g,{class:"mt-1 ma-0 pa-0"},{default:e(()=>[(i(!0),I(X,null,P(t(S),l=>(i(),p(c,{key:l._id,cols:"12",md:"4",sm:"6",class:"ma-0 pa-0"},{default:e(()=>[a(C,{onClick:W=>t(r).push(`/admin/school/${l._id}`),class:"text-center align-center pt-4 pb-4"},{default:e(()=>[u(h(l.town.name)+", "+h(l.name),1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]),_:1}))}});export{ne as default};
