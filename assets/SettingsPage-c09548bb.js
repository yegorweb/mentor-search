import{d as le,a as te,u as ae,H as se,r as m,R as oe,w as ue,I as $,c as I,e as s,g as ne,o as c,f as l,D as r,B as b,C as D,k as w,Y as re,l as t,x as G,F as q,Z as ie,_ as de,A as y,$ as U,a0 as me,a1 as z,a2 as ce,h as B,a3 as fe,M,i as ve,j as R,v as H,J,a4 as pe}from"./index-4f6c5d65.js";import{_ as ge}from"./BackButton.vue_vue_type_script_setup_true_lang-603e5d2f.js";import{E as L}from"./EntryContainer-a8530ab8.js";import{u as _e,a as x}from"./vee-validate.esm-0f4ff9e4.js";import{u as be}from"./school-9a21f72d.js";import{_ as Ve}from"./lodash-57ff8d49.js";import"./_plugin-vue_export-helper-c27b6911.js";const he=["onClick"],we={class:"d-flex flex-column align-start"},ye=B("div",{class:"text-body-1 mb-2 font-weight-bold"}," Контакты ",-1),xe={key:0,class:"d-flex flex-column mb-2 w-100",style:{gap:"6px"}},ke={class:"text-body-2 text-red"},Ae=le({__name:"SettingsPage",async setup(Ce){var E,N;let V,F;localStorage.setItem("newUser","false"),document.title="Натройки — Ищу наставника";let j=te(),O=ae(),P=se(),T=be(),u=j.user,Y=P.towns,n=m(u.town),f=m(u.grade),h=m(u.roles),v=m(oe.isMentor(u.roles)),p=m(0),Z=["Редактрировать профиль","Изменить пароль","Мои подписки"],k=m(!1);const{meta:K,handleSubmit:Q}=_e({initialValues:{name:u.name,description:(E=u.description)!=null?E:"",contacts:(N=u.contacts)!=null?N:[],school:u.school},validationSchema:{name(o){return o.length<4?"слишком короткое имя":o.length>21?"слишком длинное имя":!0},description(o){return o.length>150?"слишком длинное описание":!0},contacts(o){for(let e of o){if(e.name.length===0||e.link.length===0)return"в каждом контакте должны быть название и ссылка";if(e.name.length>15)return"слишком длинное название в контакте";if(e.link.length>500)return"кажется тут слишком длинная ссылка"}return!0},school(o){return o?!0:"укажите"}}});let C=x("name"),S=x("description"),i=x("contacts"),g=x("school"),A=m(([V,F]=ue(()=>T.get_all_in_town(n.value._id)),V=await V,F(),V));$(n,async(o,e)=>{Ve.isEqual(o,e)||(g.value.value=null,A.value=await T.get_all_in_town(n.value._id))}),$(v,o=>{o?h.value.push("mentor"):h.value=h.value.filter(e=>e!=="mentor")});const W=Q(async o=>{var e;k.value=!0,await j.updateUser(Object.assign(o,{town:n.value._id,school:(e=g.value.value)==null?void 0:e._id,grade:f.value,roles:h.value})),O.push(`/user/${u._id}`),k.value=!1});function X(){let o=[{digit:"—",number:0}];for(let e=1;e<=11;e++)o.push({digit:e.toString(),number:e});return o}return(o,e)=>(c(),I(ne,null,{default:s(()=>[l(ge),l(y,{class:"mt-1 align-start"},{default:s(()=>[l(r,{cols:"12",md:"5",lg:"4",xl:"3"},{default:s(()=>[l(L,{class:"d-flex flex-column"},{default:s(()=>[(c(!0),b(q,null,D(t(Z),(a,d)=>(c(),b("div",{key:d,onClick:_=>w(p)?p.value=d:p=d,class:re(`cursor-pointer pt-1 pb-1 font-weight-semibold ${t(p)!==d?"text-teal-darken-1":""}`)},G(a),11,he))),128))]),_:1})]),_:1}),l(r,null,{default:s(()=>[t(p)===0?(c(),I(L,{key:0},{default:s(()=>[l(ie,{onSubmit:de(t(W),["prevent"])},{default:s(()=>[l(y,{class:"mt-1"},{default:s(()=>[l(r,{cols:"12",sm:"6"},{default:s(()=>[l(U,{label:"Имя Фамилия",modelValue:t(C).value.value,"onUpdate:modelValue":e[0]||(e[0]=a=>t(C).value.value=a),"error-messages":t(C).errorMessage.value,placeholder:"Василий Петров",variant:"outlined",density:"comfortable"},null,8,["modelValue","error-messages"])]),_:1}),l(r,{cols:"12",sm:"6"},{default:s(()=>[l(me,{label:"Кто вы?",modelValue:t(v),"onUpdate:modelValue":e[1]||(e[1]=a=>w(v)?v.value=a:v=a),"hide-details":"",column:""},{default:s(()=>[l(z,{label:"Наставляемый",value:!1}),l(z,{label:"Наставник",value:!0})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(y,null,{default:s(()=>[l(r,{cols:"12",sm:"6"},{default:s(()=>[l(ce,{label:"Описание",modelValue:t(S).value.value,"onUpdate:modelValue":e[2]||(e[2]=a=>t(S).value.value=a),"error-messages":t(S).errorMessage.value,counter:150,variant:"outlined",class:"w-100"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),B("div",we,[ye,t(i).value.value.length>0?(c(),b("div",xe,[l(fe,{name:"list"},{default:s(()=>[(c(!0),b(q,null,D(t(i).value.value,(a,d)=>(c(),b("div",{class:"d-flex flex-row justify-space-between",key:d},[l(U,{placeholder:"ВКонтакте",modelValue:a.name,"onUpdate:modelValue":_=>a.name=_,variant:"outlined",density:"compact",class:"w-30","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),l(U,{placeholder:"https://vk.com/vasiliy",modelValue:a.link,"onUpdate:modelValue":_=>a.link=_,variant:"outlined",density:"compact",class:"ml-2","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),l(M,{onClick:_=>t(i).value.value=t(i).value.value.filter((Se,ee)=>ee!==d),variant:"tonal",class:"ml-2 font-weight-semibold bg-button"},{default:s(()=>[l(ve,null,{default:s(()=>[R("mdi-delete")]),_:1})]),_:2},1032,["onClick"])]))),128))]),_:1})])):H("",!0),B("div",ke,G(t(i).errorMessage.value),1),l(M,{onClick:e[3]||(e[3]=a=>t(i).value.value.push({name:"",link:"https://"})),"prepend-icon":"mdi-plus",variant:"tonal",disabled:t(i).value.value.length>3,class:"text-body-2 pl-5 pr-5 font-weight-semibold bg-button"},{default:s(()=>[R(" Добавить ")]),_:1},8,["disabled"])]),l(y,{class:"mt-8"},{default:s(()=>[l(r,{cols:"12",sm:"6"},{default:s(()=>[l(J,{label:"Город",modelValue:t(n),"onUpdate:modelValue":e[4]||(e[4]=a=>w(n)?n.value=a:n=a),items:t(Y),"item-title":"name","auto-select-first":"","no-data-text":"Не найдено","return-object":"",density:"comfortable",variant:"outlined",class:"w-100","hide-details":""},null,8,["modelValue","items"])]),_:1}),l(r,{cols:"12",sm:"6"},{default:s(()=>[l(J,{label:"Школа",modelValue:t(g).value.value,"onUpdate:modelValue":e[5]||(e[5]=a=>t(g).value.value=a),"error-messages":t(g).errorMessage.value,items:t(A),"item-title":"name","auto-select-first":"","return-object":"",density:"comfortable",variant:"outlined",class:"w-100","hide-details":""},null,8,["modelValue","error-messages","items"])]),_:1}),l(r,{cols:"12",sm:"6"},{default:s(()=>[l(pe,{label:"Класс",modelValue:t(f),"onUpdate:modelValue":e[6]||(e[6]=a=>w(f)?f.value=a:f=a),items:X(),"item-title":"digit","item-value":"number",density:"comfortable",variant:"outlined",class:"w-100","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1}),l(M,{type:"submit",loading:t(k),disabled:!t(K).valid,class:"bg-accent mb-2 mt-8"},{default:s(()=>[R(" Сохранить ")]),_:1},8,["loading","disabled"])]),_:1},8,["onSubmit"])]),_:1})):H("",!0)]),_:1})]),_:1})]),_:1}))}});export{Ae as default};
