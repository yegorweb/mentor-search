import{d as J,a2 as K,a3 as Q,a as W,r as n,u as X,o as a,c,b as l,B as o,j as e,C as Y,f as _,l as Z,t as r,v as i,p as m,F as ee,h as A,k as d,I as h,P as te,i as F,a4 as se,y as ae,s as H,n as le,O as oe}from"./index-ff565f42.js";import{E as g}from"./EntryService-764d1054.js";const ie={class:"d-flex align-start w-100 justify-start flex-column"},ne={class:"d-flex ml-4 flex-column justify-start"},re={class:"font-author font-weight-semibold"},de={class:"text-gray text-body-2"},ue={style:{"column-gap":"16px"},class:"d-flex align-center flex-row flex-wrap mr-4"},ce={class:"text-h6 font-weight-black"},_e={class:"text-body font-weight-regular"},fe={class:"text-body font-weight-regular"},pe=["innerHTML"],me={class:"d-flex mt-5 flex-column justify-start"},ve={key:0,class:"mb-2"},he={key:0},ge={style:{"row-gap":"6px"},class:"d-flex flex-row flex-wrap justify-start align-center"},ye={key:3,class:"text-body font-weight-regular"},we={key:1,style:{"row-gap":"6px"},class:"d-flex mt-2 flex-row flex-wrap justify-start align-center"},be={key:2,class:"mt-2 w-100 text-red"},Ce=J({__name:"MentorEntry",props:{entry:{type:Object,required:!0},show_location:{type:Boolean,required:!1,default:!1},hide_user:{type:Boolean,required:!1,default:!1}},setup(O){var R,L,M;const y=O;let{showing:b,responses:x}=K(Q()),s=W().getUser(),t=n(y.entry),w=n(!1),k=n(!1),v=n(t.value.responses.includes(s==null?void 0:s._id)),z=X(),f=t.value.author._id==(s==null?void 0:s._id),E=((R=s==null?void 0:s.roles)==null?void 0:R.includes("school-admin"))&&((L=s==null?void 0:s.administered_schools)==null?void 0:L.includes(t.value.school._id))||((M=s==null?void 0:s.roles)==null?void 0:M.includes("global-admin")),C=n(v.value?"Убрать отклик":"Откликнуться");async function P(){if(w.value=!0,t.value.responses.includes(s==null?void 0:s._id)){await g.cancel_response(t.value._id).then(()=>{t.value.responses=t.value.responses.filter(N=>N!==(s==null?void 0:s._id)),C.value="Откликнуться",v.value=!1}).finally(()=>w.value=!1);return}await g.response(t.value._id).then(()=>{t.value.responses.push(s==null?void 0:s._id),C.value="Убрать отклик",v.value=!0}).finally(()=>w.value=!1)}async function D(){k.value=!0,await g.delete(t.value._id).finally(()=>k.value=!1)}let j=n(!1),V=n(!1),B=n(!1),$=n(!1);async function U(){j.value=!0,await g.verify(t.value._id,!0).then(()=>{V.value=!0,$.value=!1}).finally(()=>j.value=!1)}async function G(){B.value=!0,await g.verify(t.value._id,!1).then(()=>{$.value=!0,V.value=!1}).finally(()=>B.value=!1)}return(N,p)=>(a(),c(oe,{class:"justify-space-between",style:{position:"relative"}},{default:l(()=>{var T,q,I,S;return[o("div",ie,[e(y).hide_user?i("",!0):(a(),c(Y,{key:0,onClick:p[0]||(p[0]=u=>e(z).push(`/user/${e(t).author._id}`)),class:"flex-row ma-0 mb-2 pa-0 flex-nowrap align-center justify-start cursor-pointer"},{default:l(()=>{var u;return[_(Z,{image:e(t).author.avatar_url,color:"blue"},null,8,["image"]),o("div",ne,[o("div",re,r(e(t).author.name),1),o("div",de,r((u=e(t).author.ranks)==null?void 0:u.join(", ")),1)])]}),_:1})),o("div",ue,[o("div",ce,r(e(t).subject),1),e(t).limit?(a(),m(ee,{key:0},[o("div",_e,r(e(t).limit)+" чел.",1),o("div",fe,"осталось: "+r(e(t).limit-e(t).responses.length),1)],64)):i("",!0)]),o("div",{class:"mt-1",innerHTML:e(t).description},null,8,pe)]),o("div",me,[e(t).town._id!=((q=(T=e(s))==null?void 0:T.town)==null?void 0:q._id)||e(t).school._id!=((S=(I=e(s))==null?void 0:I.school)==null?void 0:S._id)||e(y).show_location?(a(),m("div",ve,[o("span",null,[_(A,{icon:"mdi-map-marker",class:"mr-1",color:"teal-lighten-1"})]),e(t).town._id!==e(s).town._id?(a(),m("span",he,r(e(t).town.name+", "),1)):i("",!0),d(r(e(t).school.name),1)])):i("",!0),o("div",ge,[!e(f)&&!e(t).on_moderation?(a(),c(h,{key:0,onClick:P,loading:e(w),disabled:!e(v)&&e(t).limit&&e(t).limit-e(t).responses.length===0,size:"small",variant:"tonal",class:te(`text-body-2 pl-5 pr-5 mr-3 font-weight-semibold ${e(v)?"bg-accent":"bg-button"}`)},{default:l(()=>[d(r(e(C)),1)]),_:1},8,["loading","disabled","class"])):i("",!0),e(y).hide_user?i("",!0):(a(),c(h,{key:1,size:"small",to:`/user/${e(t).author._id}`,variant:"tonal",class:"text-body-2 pl-5 pr-5 font-weight-semibold bg-button"},{default:l(()=>[d("Посмотреть профиль")]),_:1},8,["to"])),e(f)&&e(t).responses.length!==0?(a(),c(h,{key:2,size:"small",variant:"tonal",class:"text-body-2 pl-5 pr-5 mr-3 font-weight-semibold bg-button",onClick:p[1]||(p[1]=u=>{F(x)?x.value=e(t).responses:x=e(t).responses,F(b)?b.value=!0:b=!0})},{default:l(()=>[d("Посмотреть отклики ("+r(e(t).responses.length)+")",1)]),_:1})):i("",!0),e(t).responses.length===0&&e(f)&&!e(t).on_moderation&&e(t).moderation_result?(a(),m("div",ye,"Откликов нет")):i("",!0)]),e(E)&&e(t).on_moderation?(a(),m("div",we,[_(h,{size:"small",variant:"tonal",class:"text-body-2 mr-3 pl-5 pr-5 font-weight-semibold bg-light-green-darken-2",onClick:U,loading:e(j),disabled:e(V)},{default:l(()=>[d("Принять")]),_:1},8,["loading","disabled"]),_(h,{size:"small",variant:"tonal",class:"text-body-2 pl-5 pr-5 font-weight-semibold bg-red",onClick:G,loading:e(B),disabled:e($)},{default:l(()=>[d("Отказать")]),_:1},8,["loading","disabled"])])):i("",!0),e(f)&&!e(t).on_moderation&&!e(t).moderation_result?(a(),m("div",be," Ваша запись не одобрена администратором. Отредактируйте запись, чтобы отправить отправить на проверку снова ")):i("",!0)]),e(f)||e(E)?(a(),c(se,{key:0,location:"start"},{activator:l(({props:u})=>[_(A,ae({class:"pa-4",style:{position:"absolute",right:"12px",top:"12px"},icon:"mdi-dots-vertical"},u),null,16)]),default:l(()=>[_(le,{density:"compact"},{default:l(()=>[e(f)?(a(),c(H,{key:0,"prepend-icon":"mdi-pencil",onClick:p[2]||(p[2]=u=>e(z).push(`/edit/${e(t)._id}`))},{default:l(()=>[d(" Редактировать ")]),_:1})):i("",!0),_(H,{"prepend-icon":"mdi-delete",onClick:D,loading:e(k)},{default:l(()=>[d(" Удалить ")]),_:1},8,["loading"])]),_:1})]),_:1})):i("",!0)]}),_:1}))}});export{Ce as _};
