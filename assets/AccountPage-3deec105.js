import{_ as _sfc_main$1}from"./BackButton.vue_vue_type_script_setup_true_lang-603e5d2f.js";import{_ as _sfc_main$2}from"./MentorEntry.vue_vue_type_style_index_0_lang-a4d399d5.js";import{d as defineComponent,u as useRouter,a as useAuth,K as reactive,w as withAsyncContext,R as RolesService,I as watch,L as onBeforeRouteUpdate,c as createBlock,e as withCtx,g as VContainer,o as openBlock,h as createBaseVNode,f as createVNode,l as unref,B as createElementBlock,j as createTextVNode,i as VIcon,v as createCommentVNode,m as VAvatar,x as toDisplayString,F as Fragment,C as renderList,M as VBtn,N as VTooltip,O as VCombobox,P as VChip,t as mergeProps,D as VCol,E as VCard,J as VAutocomplete,H as useTown,Q as VCardActions,T as VSpacer,A as VRow,U as VDialog,W as pushScopeId,X as popScopeId}from"./index-4f6c5d65.js";import{u as useUser}from"./Slave.vue_vue_type_script_setup_true_lang-cdf8ecb2.js";import{u as useEntry}from"./entry-7a05a159.js";import{_ as _export_sfc}from"./_plugin-vue_export-helper-c27b6911.js";import"./EntryContainer-a8530ab8.js";import"./EntryService-e6d5ed51.js";const _withScopeId=e=>(pushScopeId("data-v-55894600"),e=e(),popScopeId(),e),_hoisted_1={class:"d-flex flex-row w-100 flex-nowrap justify-space-between align-center"},_hoisted_2=_withScopeId(()=>createBaseVNode("div",{class:"text-body-4 ml-1 font-weight-semibold"}," выйти ",-1)),_hoisted_3={style:{"column-gap":"30px","row-gap":"10px"},class:"box w-100 mt-4 mb-4 d-flex flex-column flex-sm-row flex-nowrap justify-center justify-sm-start align-center align-sm-start"},_hoisted_4={class:"d-flex flex-column justify-center justify-sm-start w-sm-100 align-center align-sm-start"},_hoisted_5={class:"text-h5 text-center font-weight-bold"},_hoisted_6={style:{"column-gap":"20px"},class:"d-flex mt-1 align-center justify-center justify-sm-start flex-wrap flex-row font-weight-bold text-text_gray"},_hoisted_7={key:0,class:"text-center"},_hoisted_8=_withScopeId(()=>createBaseVNode("span",{class:"mdi mdi-star"},null,-1)),_hoisted_9={key:1},_hoisted_10={class:"font-weight-bold text-text_gray"},_hoisted_11={key:0,class:"mt-2 pb-2 text-justify text-sm-start"},_hoisted_12={key:1,class:"d-flex pt-2 flex-row flex-wrap justify-center justify-sm-start",style:{"column-gap":"12px","row-gap":"6px"}},_hoisted_13=["href"],_hoisted_14={key:0,class:"pt-4 pb-4"},_hoisted_15=_withScopeId(()=>createBaseVNode("div",{class:"text-h5 font-weight-bold"}," Управление ",-1)),_hoisted_16={class:"mt-3 d-flex flex-row flex-wrap"},_hoisted_17={key:1,class:"d-flex flex-column pt-4 pb-4 w-100"},_hoisted_18=_withScopeId(()=>createBaseVNode("div",{class:"text-h5 font-weight-bold"},"На модерации",-1)),_hoisted_19={class:"mt-4 entries-container"},_hoisted_20={key:2,class:"d-flex flex-column pt-4 pb-4 w-100"},_hoisted_21=_withScopeId(()=>createBaseVNode("div",{class:"text-h5 mt-8 font-weight-bold"}," Мои отклики ",-1)),_hoisted_22={class:"mt-4 entries-container"},_hoisted_23={key:3,class:"d-flex flex-column pt-4 pb-4 w-100"},_hoisted_24=_withScopeId(()=>createBaseVNode("div",{class:"text-h5 font-weight-bold"}," Наставник по ",-1)),_hoisted_25={class:"entries-container mt-4"},_hoisted_26={key:4,class:"d-flex flex-column pt-4 pb-4"},_hoisted_27=_withScopeId(()=>createBaseVNode("div",{class:"text-h5 font-weight-bold"}," Уроки ",-1)),_hoisted_28={class:"mt-4 entries-container"},_hoisted_29={key:5,class:"d-flex flex-column pt-4 pb-4"},_hoisted_30=_withScopeId(()=>createBaseVNode("div",{class:"text-h5 font-weight-bold"}," Клубы ",-1)),_hoisted_31={class:"mt-4 entries-container"},_sfc_main=defineComponent({__name:"AccountPage",props:["id"],async setup(__props){let __temp,__restore;const props=__props;let new_user=eval(localStorage.getItem("newUser")||"false");useRouter();let auth=useAuth(),userStore=useUser(),entryStore=useEntry(),id=props.id,viewer=auth.user,user=reactive(viewer&&viewer._id===id?viewer:([__temp,__restore]=withAsyncContext(()=>userStore.get_by_id(id)),__temp=await __temp,__restore(),__temp));document.title=`${user.name} — Ищу наставника`;let my_page=(viewer==null?void 0:viewer._id)===id,viewer_is_admin=viewer&&(RolesService.isAdminOfSchool(viewer.roles,user.school._id)||RolesService.isAdminOfTown(viewer.roles,user.town._id)||RolesService.isGlobalAdmin(viewer.roles));viewer&&RolesService.isSomeAdmin(viewer.roles);let entries=my_page?([__temp,__restore]=withAsyncContext(()=>entryStore.get_my_entries()),__temp=await __temp,__restore(),__temp):([__temp,__restore]=withAsyncContext(()=>entryStore.get_by_author(user._id)),__temp=await __temp,__restore(),__temp),mentorship_entries=entries.filter(e=>e.type==="mentor"&&e.on_moderation===!1&&e.moderation_result===!0),lesson_entries=entries.filter(e=>e.type==="lesson"&&e.on_moderation===!1&&e.moderation_result===!0),club_entries=entries.filter(e=>e.type==="club"&&e.on_moderation===!1&&e.moderation_result===!0),entries_on_moderation=entries.filter(e=>e.on_moderation===!0||my_page&&e.on_moderation===!1&&e.moderation_result===!1),responsed_entries=[];my_page&&!RolesService.isMentor(user.roles)&&(responsed_entries=([__temp,__restore]=withAsyncContext(()=>userStore.get_my_responses()),__temp=await __temp,__restore(),__temp)),watch(user,async e=>{userStore.changeUser(e)}),onBeforeRouteUpdate(e=>{window.location.href=e.path});async function logout(){await auth.logout(),window.location.href="/"}function removeRank(e){user.ranks.splice(user.ranks.indexOf(e),1)}return(e,o)=>(openBlock(),createBlock(VContainer,{class:"mt-1"},{default:withCtx(()=>[createBaseVNode("div",_hoisted_1,[createVNode(_sfc_main$1),unref(my_page)?(openBlock(),createElementBlock("div",{key:0,onClick:logout,class:"d-flex pt-1 pr-1 pb-1 cursor-pointer flex-row flex-nowrap align-center justify-start"},[createVNode(VIcon,null,{default:withCtx(()=>[createTextVNode("mdi-logout")]),_:1}),_hoisted_2])):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_3,[createVNode(VAvatar,{image:unref(user).avatar_url,color:"blue",size:"130"},null,8,["image"]),createBaseVNode("div",_hoisted_4,[createBaseVNode("div",_hoisted_5,toDisplayString(unref(user).name),1),createBaseVNode("div",_hoisted_6,[createBaseVNode("div",null,toDisplayString(unref(RolesService).getType(unref(user).roles)),1),unref(user).ranks&&unref(user).ranks.length>0?(openBlock(),createElementBlock("div",_hoisted_7,[_hoisted_8,createTextVNode(" "+toDisplayString(unref(user).ranks.join(", ")),1)])):createCommentVNode("",!0),unref(user).grade!==0?(openBlock(),createElementBlock("div",_hoisted_9,toDisplayString(unref(user).grade)+" класс ",1)):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_10,toDisplayString(unref(user).town.name+", "+unref(user).school.name),1),unref(user).description&&unref(user).description.length>0?(openBlock(),createElementBlock("div",_hoisted_11,toDisplayString(unref(user).description),1)):createCommentVNode("",!0),unref(user).contacts&&unref(user).contacts.length>0?(openBlock(),createElementBlock("div",_hoisted_12,[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(user).contacts,t=>(openBlock(),createElementBlock("a",{key:t.link,target:"_blank",href:t.link,style:{"text-decoration":"none"}},[createVNode(VBtn,{size:"small",variant:"tonal",class:"text-body-2 pl-5 pr-5 font-weight-semibold bg-button"},{default:withCtx(()=>[createTextVNode(toDisplayString(t.name),1)]),_:2},1024)],8,_hoisted_13))),128))])):createCommentVNode("",!0),unref(my_page)?(openBlock(),createBlock(VBtn,{key:2,size:"small",variant:"tonal",to:"/settings",class:"text-body-2 mt-2 pl-5 pr-5 font-weight-semibold bg-blue"},{default:withCtx(()=>[createTextVNode(" Редактировать профиль "),unref(new_user)?(openBlock(),createBlock(VTooltip,{key:0,location:"bottom start",activator:"parent",color:"gray","model-value":""},{default:withCtx(()=>[createTextVNode(" Привет, новый пользователь! Ты можешь добавить больше о себе ")]),_:1})):createCommentVNode("",!0)]),_:1})):createCommentVNode("",!0)])]),unref(viewer_is_admin)&&!unref(my_page)?(openBlock(),createElementBlock("div",_hoisted_14,[_hoisted_15,createVNode(VCol,{cols:"12",lg:"6",class:"ma-0 pa-0 mt-4"},{default:withCtx(()=>[createVNode(VCombobox,{modelValue:unref(user).ranks,"onUpdate:modelValue":o[0]||(o[0]=t=>unref(user).ranks=t),chips:"",clearable:"",label:"Звания",multiple:"","prepend-icon":"mdi-chevron-triple-up",density:"comfortable",variant:"solo",class:"mt-2","hide-details":""},{selection:withCtx(({attrs:t,item:s,select:r,selected:n})=>[createVNode(VChip,mergeProps(t,{"model-value":n,closable:"",onClick:r,"onClick:close":a=>removeRank(s)}),{default:withCtx(()=>[createBaseVNode("strong",null,toDisplayString(s),1),createTextVNode("  ")]),_:2},1040,["model-value","onClick","onClick:close"])]),_:1},8,["modelValue"])]),_:1}),createBaseVNode("div",_hoisted_16,[createVNode(VBtn,{"prepend-icon":"mdi-star"},{default:withCtx(()=>[createTextVNode(" Дать награду ")]),_:1}),unref(RolesService).isSomeAdmin(unref(user).roles)?createCommentVNode("",!0):(openBlock(),createBlock(VBtn,{key:0,"prepend-icon":"mdi-delete",class:"bg-red ml-3"},{default:withCtx(()=>[createTextVNode(" Удалить ")]),_:1})),unref(RolesService).isGlobalAdmin(unref(viewer).roles)||unref(RolesService).isTownAdmin(unref(viewer).roles)?(openBlock(),createBlock(VBtn,{key:1,class:"ml-3"},{default:withCtx(()=>[createTextVNode(" Назначить админом города "),createVNode(VDialog,{activator:"parent"},{default:withCtx(()=>[createVNode(VCard,{class:"rounded-lg"},{default:withCtx(()=>[createVNode(VAutocomplete,{items:unref(useTown)().towns,variant:"solo",label:"Город"},null,8,["items"]),createVNode(VCardActions,null,{default:withCtx(()=>[createVNode(VSpacer),createVNode(VRow,null,{default:withCtx(()=>[createVNode(VCol,null,{default:withCtx(()=>[createVNode(VBtn,null,{default:withCtx(()=>[createTextVNode(" Назначить ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):createCommentVNode("",!0),unref(RolesService).isSomeAdmin(unref(viewer).roles)?(openBlock(),createBlock(VBtn,{key:2,class:"ml-3"},{default:withCtx(()=>[createTextVNode(" Назначить админом школы ")]),_:1})):createCommentVNode("",!0)])])):createCommentVNode("",!0),(unref(my_page)||unref(viewer_is_admin))&&unref(entries_on_moderation).length>0?(openBlock(),createElementBlock("div",_hoisted_17,[_hoisted_18,createBaseVNode("div",_hoisted_19,[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(entries_on_moderation),t=>(openBlock(),createBlock(_sfc_main$2,{key:t._id,hide_user:"",entry:t,show_location:!1},null,8,["entry"]))),128))])])):createCommentVNode("",!0),unref(my_page)&&!unref(RolesService).isMentor(unref(user).roles)&&unref(responsed_entries).length>0?(openBlock(),createElementBlock("div",_hoisted_20,[_hoisted_21,createBaseVNode("div",_hoisted_22,[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(responsed_entries),t=>(openBlock(),createBlock(_sfc_main$2,{key:t._id,hide_user:"",entry:t,show_location:!1},null,8,["entry"]))),128))])])):createCommentVNode("",!0),unref(mentorship_entries).length>0?(openBlock(),createElementBlock("div",_hoisted_23,[_hoisted_24,createBaseVNode("div",_hoisted_25,[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(mentorship_entries),t=>(openBlock(),createBlock(_sfc_main$2,{key:t._id,hide_user:"",entry:t,show_location:!1},null,8,["entry"]))),128))])])):createCommentVNode("",!0),unref(lesson_entries).length>0?(openBlock(),createElementBlock("div",_hoisted_26,[_hoisted_27,createBaseVNode("div",_hoisted_28,[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(lesson_entries),t=>(openBlock(),createBlock(_sfc_main$2,{key:t._id,hide_user:"",entry:t,show_location:!1},null,8,["entry"]))),128))])])):createCommentVNode("",!0),unref(club_entries).length>0?(openBlock(),createElementBlock("div",_hoisted_29,[_hoisted_30,createBaseVNode("div",_hoisted_31,[(openBlock(!0),createElementBlock(Fragment,null,renderList(unref(club_entries),t=>(openBlock(),createBlock(_sfc_main$2,{key:t._id,hide_user:"",entry:t,show_location:!1},null,8,["entry"]))),128))])])):createCommentVNode("",!0)]),_:1}))}}),AccountPage_vue_vue_type_style_index_0_scoped_55894600_lang="",AccountPage=_export_sfc(_sfc_main,[["__scopeId","data-v-55894600"]]);export{AccountPage as default};
